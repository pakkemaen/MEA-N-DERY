<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEA(N)DERY - AI Mead Recipe Creator</title>
    <meta name="theme-color" content="#a89a87"/>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="new-logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>

    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                colors: {
                    // MD3 Core Palette Reference
                    primary: {
                        DEFAULT: 'rgb(var(--md-sys-color-primary) / <alpha-value>)',
                        on: 'rgb(var(--md-sys-color-on-primary) / <alpha-value>)',
                        container: 'rgb(var(--md-sys-color-primary-container) / <alpha-value>)',
                        onContainer: 'rgb(var(--md-sys-color-on-primary-container) / <alpha-value>)',
                    },
                    secondary: {
                        DEFAULT: 'rgb(var(--md-sys-color-secondary) / <alpha-value>)',
                        on: 'rgb(var(--md-sys-color-on-secondary) / <alpha-value>)',
                        container: 'rgb(var(--md-sys-color-secondary-container) / <alpha-value>)',
                        onContainer: 'rgb(var(--md-sys-color-on-secondary-container) / <alpha-value>)',
                    },
                    tertiary: { // Gebruikt voor "Specials" of accenten
                        DEFAULT: 'rgb(var(--md-sys-color-tertiary) / <alpha-value>)',
                        container: 'rgb(var(--md-sys-color-tertiary-container) / <alpha-value>)',
                    },
                    surface: {
                        DEFAULT: 'rgb(var(--md-sys-color-surface) / <alpha-value>)',      // Body background
                        on: 'rgb(var(--md-sys-color-on-surface) / <alpha-value>)',        // Text color
                        variant: 'rgb(var(--md-sys-color-surface-variant) / <alpha-value>)',
                        onVariant: 'rgb(var(--md-sys-color-on-surface-variant) / <alpha-value>)', // Icons / Subtitles
                        container: 'rgb(var(--md-sys-color-surface-container) / <alpha-value>)', // Card background
                        bright: 'rgb(var(--md-sys-color-surface-bright) / <alpha-value>)',
                    },
                    outline: {
                        DEFAULT: 'rgb(var(--md-sys-color-outline) / <alpha-value>)',
                        variant: 'rgb(var(--md-sys-color-outline-variant) / <alpha-value>)',
                    },
                    error: {
                        DEFAULT: 'rgb(var(--md-sys-color-error) / <alpha-value>)',
                        container: 'rgb(var(--md-sys-color-error-container) / <alpha-value>)',
                    },
                    // Legacy mappings om te zorgen dat je oude HTML niet breekt
                    app: {
                        primary: 'rgb(var(--md-sys-color-surface) / <alpha-value>)',
                        secondary: 'rgb(var(--md-sys-color-surface-container) / <alpha-value>)',
                        tertiary: 'rgb(var(--md-sys-color-surface-variant) / <alpha-value>)',
                        brand: 'rgb(var(--md-sys-color-primary) / <alpha-value>)',
                        action: 'rgb(var(--md-sys-color-primary) / <alpha-value>)', // Action is nu Primary
                        header: 'rgb(var(--md-sys-color-on-surface) / <alpha-value>)'
                    }
                },
                fontFamily: {
                    sans: ['"Barlow Semi Condensed"', 'sans-serif'],
                    header: ['"Barlow Semi Condensed"', 'sans-serif']
                },
                borderRadius: {
                    'xl': '1rem',
                    '2xl': '1.5rem',
                    '3xl': '2rem', // MD3 standaard voor grote cards
                    'pill': '9999px'
                },
                boxShadow: {
                    'elevation-1': '0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.30)',
                    'elevation-2': '0px 2px 6px 2px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.30)',
                    'elevation-3': '0px 4px 8px 3px rgba(0, 0, 0, 0.15), 0px 1px 3px 0px rgba(0, 0, 0, 0.30)',
                }
            }
        }
    }
</script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Semi+Condensed:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <link rel="stylesheet" href="style.css">

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('Service Worker Registered! ðŸš€', reg.scope))
                    .catch(err => console.error('SW Fail:', err));
            });
        }
</script>

</head>

<body class="bg-surface text-on-surface antialiased selection:bg-primary-container selection:text-on-primary-container h-full">

    <div id="login-view" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-surface p-4 transition-opacity duration-500">
    
    <div class="w-full max-w-sm flex flex-col items-center">
        
        <div class="mb-8 relative">
            <div class="absolute inset-0 bg-primary/20 blur-xl rounded-full opacity-20"></div> <img src="logo.png" class="h-24 w-auto object-contain relative z-10 drop-shadow-sm" alt="Logo">
        </div>

        <h1 class="text-2xl font-header font-bold text-on-surface tracking-widest uppercase mb-2">
            Mea(n)dery
        </h1>
        <p class="text-xs text-on-surface-variant tracking-[0.3em] uppercase opacity-60 mb-10">
            Brewing Assistant
        </p>

        <button id="google-signin-btn" 
        onclick="window.signInWithGoogle()" 
        class="w-full bg-primary text-on-primary font-bold py-4 px-6 rounded-lg shadow-elevation-1 hover:shadow-elevation-2 hover:scale-[1.01] transition-all duration-300 flex items-center justify-center gap-3 border border-transparent uppercase tracking-wider text-sm cursor-pointer">
    
    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"/></svg>
    
    <span>Sign in with Google</span>
</button>

        <div class="mt-12 text-center">
            <p class="text-[10px] text-outline-variant">v2.4 &bull; Private Build</p>
        </div>

    </div>
</div> 
    <div id="app-content" class="container mx-auto p-4 md:p-8 max-w-7xl hidden min-h-screen flex flex-col">
        
        <header class="text-center mt-2 mb-4 no-print flex flex-col justify-center items-center py-2 relative">
            <div class="relative">
                <img src="logo.png" 
                     class="h-14 w-auto object-contain drop-shadow-md dark:brightness-90" 
                     alt="Mea(n)dery Brewbuddy">
            </div>
            <p class="text-[9px] uppercase tracking-[0.2em] text-primary font-bold mt-1 opacity-80">AI Brew Assistant</p>
        </header>

<div id="dashboard-main-view">
    <div class="p-2 md:p-4 overflow-y-auto no-scrollbar" style="max-height: 88vh;">
        
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
            
            <div onclick="switchMainView('brewing', 'brew-day-1')"
                 class="card p-4 cursor-pointer hover:shadow-lg transition-all duration-200 group flex flex-col items-center justify-center relative overflow-hidden bg-surface-container-low border border-outline-variant/30">
                <svg class="absolute -right-3 -bottom-3 w-20 h-20 text-primary opacity-5 group-hover:scale-105 transition-transform" fill="currentColor" viewBox="0 0 24 24"><path d="M9.5,2C5.9,2 3,4.9 3,8.5C3,12.1 5.9,15 9.5,15C13.1,15 16,12.1 16,8.5C16,4.9 13.1,2 9.5,2M9.5,13C7,13 5,11 5,8.5C5,6 7,4 9.5,4C12,4 14,6 14,8.5C14,11 12,13 9.5,13Z"></path></svg>
                
                <p class="text-[10px] font-bold text-on-surface-variant uppercase tracking-widest mb-0.5 z-10">Primary</p>
                <p id="stat-primary-batches" class="text-3xl font-header font-medium text-primary z-10">--</p>
            </div>

            <div onclick="switchMainView('brewing', 'brew-day-2')" 
                 class="card p-4 cursor-pointer hover:shadow-lg transition-all duration-200 group flex flex-col items-center justify-center relative overflow-hidden bg-surface-container-low border border-outline-variant/30">
                <svg class="absolute -right-3 -bottom-3 w-20 h-20 text-primary opacity-5 group-hover:scale-105 transition-transform" fill="currentColor" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.9L16.2,16.2Z"></path></svg>
                
                <p class="text-[10px] font-bold text-on-surface-variant uppercase tracking-widest mb-0.5 z-10">Aging</p>
                <p id="stat-aging-batches" class="text-3xl font-header font-medium text-primary z-10">--</p>
            </div>

            <div onclick="switchMainView('management', 'cellar')" 
                 class="card p-4 cursor-pointer hover:shadow-lg transition-all duration-200 group flex flex-col items-center justify-center relative overflow-hidden bg-surface-container-low border border-outline-variant/30">
                <svg class="absolute -right-3 -bottom-3 w-20 h-20 text-secondary opacity-5 group-hover:scale-105 transition-transform" fill="currentColor" viewBox="0 0 24 24"><path d="M7,2H17A2,2 0 0,1 19,4V20A2,2 0 0,1 17,22H7A2,2 0 0,1 5,20V4A2,2 0 0,1 7,2M7,4V8H17V4H7M7,10V14H17V10H7M7,16V20H17V16H7Z"></path></svg>
                
                <p class="text-[10px] font-bold text-on-surface-variant uppercase tracking-widest mb-0.5 z-10">In Cellar</p>
                <p id="stat-bottles" class="text-3xl font-header font-medium text-secondary z-10">--</p>
            </div>

            <div onclick="switchMainView('management', 'financials')" 
                 class="card p-4 cursor-pointer hover:shadow-lg transition-all duration-200 group flex flex-col items-center justify-center relative overflow-hidden bg-surface-container-low border border-outline-variant/30">
                <svg class="absolute -right-3 -bottom-3 w-20 h-20 text-tertiary opacity-5 group-hover:scale-105 transition-transform" fill="currentColor" viewBox="0 0 24 24"><path d="M5,6H23V18H5V6M14,9A3,3 0 0,1 17,12A3,3 0 0,1 14,15A3,3 0 0,1 11,12A3,3 0 0,1 14,9M9,8A2,2 0 0,1 7,10V14A2,2 0 0,1 9,16H19A2,2 0 0,1 21,14V10A2,2 0 0,1 19,8H9M1,10H3V20H19V22H1V10Z"></path></svg>
                
                <p class="text-[10px] font-bold text-on-surface-variant uppercase tracking-widest mb-0.5 z-10">Value</p>
                <p id="stat-spent" class="text-2xl font-header font-medium text-tertiary z-10">--</p>
            </div>
        </div>

                <div id="current-brew-card" class="card p-6 rounded-lg mb-6 hidden border-2 border-app-brand/20 bg-app-tertiary"></div>

                <div id="next-action-widget" class="card p-6 mb-6 hidden bg-secondary-container/30 border border-secondary/20 shadow-none">
    <h3 class="text-sm font-bold mb-3 text-secondary-on-container flex items-center gap-2 uppercase tracking-widest">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        Brewery Insight
    </h3>
    <ul id="next-action-list" class="list-disc pl-5 space-y-2 text-on-surface-variant text-sm font-medium leading-relaxed"></ul>
</div>

                <h3 class="text-xs font-bold text-primary uppercase mb-2 ml-1 tracking-wider flex items-center gap-2 mt-6">
    <span class="w-1 h-1 rounded-full bg-primary"></span> 
    Quick Actions
</h3>

<div class="grid grid-cols-4 gap-2 mb-6">
    <button onclick="switchMainView('brewing', 'creator')" 
            class="group bg-surface-container border border-outline-variant hover:border-primary hover:bg-surface-container-high p-3 rounded-2xl transition-all duration-300 flex flex-col items-center justify-center gap-2 shadow-sm active:scale-95">
        <div class="p-2 rounded-full bg-primary-container text-on-primary-container group-hover:scale-110 transition-transform">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
        </div>
        <span class="text-[10px] font-bold text-on-surface uppercase tracking-wide">Brew</span>
    </button>

    <button onclick="switchMainView('management', 'inventory')" 
            class="group bg-surface-container border border-outline-variant hover:border-primary hover:bg-surface-container-high p-3 rounded-2xl transition-all duration-300 flex flex-col items-center justify-center gap-2 shadow-sm active:scale-95">
        <div class="p-2 rounded-full bg-primary-container text-on-primary-container group-hover:scale-110 transition-transform">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
        </div>
        <span class="text-[10px] font-bold text-on-surface uppercase tracking-wide">Stock</span>
    </button>

    <button onclick="switchMainView('tools', 'calculators')" 
            class="group bg-surface-container border border-outline-variant hover:border-primary hover:bg-surface-container-high p-3 rounded-2xl transition-all duration-300 flex flex-col items-center justify-center gap-2 shadow-sm active:scale-95">
        <div class="p-2 rounded-full bg-primary-container text-on-primary-container group-hover:scale-110 transition-transform">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
        </div>
        <span class="text-[10px] font-bold text-on-surface uppercase tracking-wide">Tools</span>
    </button>

    <button onclick="switchMainView('settings', 'settings-general')" 
            class="group bg-surface-container border border-outline-variant hover:border-primary hover:bg-surface-container-high p-3 rounded-2xl transition-all duration-300 flex flex-col items-center justify-center gap-2 shadow-sm active:scale-95">
        <div class="p-2 rounded-full bg-primary-container text-on-primary-container group-hover:scale-110 transition-transform">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
        </div>
        <span class="text-[10px] font-bold text-on-surface uppercase tracking-wide">Settings</span>
    </button>
</div>
            </div>
        </div>

        <div id="brewing-main-view" class="hidden">
    
    <div class="flex items-center justify-between mb-4 no-print">
        <button class="back-to-dashboard-btn flex items-center gap-2 text-primary font-bold hover:bg-surface-variant/20 px-4 py-2 rounded-full transition-colors text-sm uppercase tracking-wide">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            Back to Dashboard
        </button>
    </div>

    <div class="mb-6 overflow-x-auto no-scrollbar py-1">
        <nav class="flex space-x-2 min-w-max p-1 bg-surface-container rounded-full border border-outline-variant w-fit mx-auto md:mx-0"> 
            <button id="creator-sub-tab" class="sub-tab active">Creator</button>
            <button id="shopping-list-sub-tab" class="sub-tab">Shopping List</button>
            <button id="brew-day-1-sub-tab" class="sub-tab">Brew Day 1</button>
            <button id="brew-day-2-sub-tab" class="sub-tab">Brew Day 2</button>
            <button id="history-sub-tab" class="sub-tab">History</button>
        </nav>
    </div>
    
    <div id="creator-view">
        <div class="flex flex-col lg:flex-row gap-6 mt-4">
            
            <aside class="lg:w-1/3 card p-5 md:p-6 control-panel overflow-y-auto border border-outline-variant/50" style="max-height: 75vh;">
    <h2 class="text-2xl text-primary font-normal mb-6 flex items-center gap-2">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
        Craft Your Mead
    </h2>
    
    <div class="mb-6 relative group">
        <label for="customDescription" class="block text-xs font-bold text-primary uppercase mb-2 ml-1 tracking-wider">Dream Description</label>
        <textarea id="customDescription" rows="4" placeholder="Describe your perfect mead (e.g. 'A sparkling cherry melomel with vanilla, 10% ABV')" class="w-full resize-none p-4"></textarea>
        <p id="description-priority-warning" class="hidden text-xs text-center text-secondary mt-2 bg-secondary-container p-2 rounded-lg">Using AI Description Mode. Manual settings below will be ignored.</p>
    </div>

    <details class="group mb-3 bg-surface-container-low rounded-xl border border-outline-variant overflow-hidden open:shadow-sm transition-all" open>
        <summary class="font-bold text-sm cursor-pointer p-4 flex justify-between items-center select-none text-on-surface hover:bg-surface-variant/10 transition-colors">
            <span class="flex items-center gap-3">
                <span class="w-8 h-8 rounded-full bg-primary-container text-on-primary-container flex items-center justify-center">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                </span>
                Base Stats
            </span>
            <svg class="w-5 h-5 text-outline transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </summary>
        <div class="p-4 pt-0 space-y-4 border-t border-transparent group-open:border-outline-variant/30 group-open:mt-2">
            <div>
                <label class="text-xs font-bold uppercase text-on-surface-variant mb-1 block ml-1">Batch Size (L)</label>
                <input type="number" id="batchSize" placeholder="5">
            </div>
            <div>
                <label class="text-xs font-bold uppercase text-on-surface-variant mb-1 block ml-1">Target ABV (%)</label>
                <input type="number" id="abv" placeholder="12">
            </div>
            <div>
                <label class="text-xs font-bold uppercase text-on-surface-variant mb-1 block ml-1">Style</label>
                <select id="style">
                    <option value="Traditional">Traditional</option>
                    <option value="Melomel">Melomel (Fruit)</option>
                    <option value="Metheglin">Metheglin (Spices)</option>
                    <option value="Bochet">Bochet (Caramelized)</option>
                    <option value="Cyser">Cyser (Apple)</option>
                    <option value="Pyment">Pyment (Grape)</option>
                    <option value="Braggot">Braggot (Malt)</option>
                    <option value="Hydromel">Hydromel (Low ABV)</option>
                </select>
            </div>
            <div>
                <label class="text-xs font-bold uppercase text-on-surface-variant mb-1 block ml-1">Sweetness</label>
                <select id="sweetness">
                    <option value="dry">Dry</option>
                    <option value="semi-sweet">Semi-Sweet</option>
                    <option value="sweet">Sweet</option>
                    <option value="dessert">Dessert</option>
                </select>
            </div>
        </div>
    </details>

    <details class="group mb-3 bg-surface-container-low rounded-xl border border-outline-variant overflow-hidden open:shadow-sm transition-all">
        <summary class="font-bold text-sm cursor-pointer p-4 flex justify-between items-center select-none text-on-surface hover:bg-surface-variant/10 transition-colors">
            <span class="flex items-center gap-3">
                <span class="w-8 h-8 rounded-full bg-secondary-container text-on-secondary-container flex items-center justify-center">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                </span>
                Ingredients
            </span>
            <svg class="w-5 h-5 text-outline transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </summary>
        <div class="p-4 pt-0 space-y-4 border-t border-transparent group-open:border-outline-variant/30 group-open:mt-2">
            <div>
                <label class="text-xs font-bold uppercase text-on-surface-variant mb-1 block ml-1">Honey Variety</label>
                <select id="honeyVariety">
                    <option value="Wildflower">Wildflower</option>
                    <option value="Acacia">Acacia</option>
                    <option value="Orange Blossom">Orange Blossom</option>
                    <option value="Clover">Clover</option>
                    <option value="Buckwheat">Buckwheat</option>
                    <option value="Linden">Linden (Lime)</option>
                    <option value="other">Other</option>
                </select>
                <input type="text" id="honeyVarietyOther" placeholder="Specify honey..." class="hidden mt-2">
            </div>

            <div id="fruit-section" class="hidden p-3 bg-surface-container rounded-lg border border-outline-variant">
                <label class="block text-xs font-bold mb-2 uppercase text-primary ml-1">Fruit Selection</label>
                <div class="grid grid-cols-2 gap-3">
                    <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="fruit_apples" class="rounded text-primary focus:ring-primary w-4 h-4 border-outline"> Apples</label>
                    <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="fruit_cherries" class="rounded text-primary focus:ring-primary w-4 h-4 border-outline"> Cherries</label>
                    <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="fruit_berries" class="rounded text-primary focus:ring-primary w-4 h-4 border-outline"> Berries</label>
                    <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="fruit_citrus" class="rounded text-primary focus:ring-primary w-4 h-4 border-outline"> Citrus</label>
                    <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="fruit_stone" class="rounded text-primary focus:ring-primary w-4 h-4 border-outline"> Stone Fruit</label>
                </div>
                <input type="text" id="fruitOther" placeholder="Other fruits..." class="mt-3">
                <div class="mt-3 pt-2 border-t border-outline-variant">
                    <label class="flex items-center text-xs font-bold text-error gap-2">
                        <input type="checkbox" id="isNoWaterCheckbox" class="rounded text-error focus:ring-error w-4 h-4 border-error"> 
                        No-Water Method (Pure Juice)
                    </label>
                </div>
            </div>

            <div id="spice-section" class="hidden p-3 bg-surface-container rounded-lg border border-outline-variant">
                <label class="block text-xs font-bold mb-2 uppercase text-primary ml-1">Spices & Herbs</label>
                <div class="grid grid-cols-2 gap-3">
                    <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="spice_cinnamon" class="rounded text-primary w-4 h-4 border-outline"> Cinnamon</label>
                    <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="spice_vanilla" class="rounded text-primary w-4 h-4 border-outline"> Vanilla</label>
                    <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="spice_cloves" class="rounded text-primary w-4 h-4 border-outline"> Cloves</label>
                    <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="spice_ginger" class="rounded text-primary w-4 h-4 border-outline"> Ginger</label>
                </div>
                <input type="text" id="spiceOther" placeholder="Other spices..." class="mt-3">
            </div>

            <div id="braggot-section" class="hidden">
                 <label class="text-xs font-bold uppercase text-on-surface-variant mb-1 block ml-1">Beer Style Base</label>
                 <input type="text" id="braggotStyle" placeholder="e.g. Stout, IPA, Wheat...">
            </div>
            
            <div class="flex items-center gap-2 p-3 bg-surface-variant/20 rounded-lg">
                <input type="checkbox" id="addOak" class="h-5 w-5 text-primary rounded border-outline focus:ring-primary">
                <label for="addOak" class="text-sm font-medium text-on-surface">Include Oak Aging</label>
            </div>
            
            <div>
                 <label class="text-xs font-bold uppercase text-on-surface-variant mb-1 block ml-1">Special / Other</label>
                 <input type="text" id="specialIngredients" placeholder="e.g. Maple Syrup, Coffee...">
            </div>
        </div>
    </details>

    <details class="group mb-6 bg-surface-container-low rounded-xl border border-outline-variant overflow-hidden open:shadow-sm transition-all">
        <summary class="font-bold text-sm cursor-pointer p-4 flex justify-between items-center select-none text-on-surface hover:bg-surface-variant/10 transition-colors">
            <span class="flex items-center gap-3">
                <span class="w-8 h-8 rounded-full bg-tertiary-container text-on-tertiary-container flex items-center justify-center">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>
                </span>
                Stock & Budget
            </span>
            <svg class="w-5 h-5 text-outline transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </summary>
        <div class="p-4 pt-0 space-y-3 border-t border-transparent group-open:border-outline-variant/30 group-open:mt-2">
            <p class="text-xs text-on-surface-variant mb-2">Check to prioritize using from inventory:</p>
            <div id="inventory-options-container" class="grid grid-cols-2 gap-3 text-sm text-on-surface">
                <label class="flex items-center gap-2"><input type="checkbox" id="useInventory_Honey" class="inventory-toggle rounded text-primary w-4 h-4 border-outline"> Honey</label>
                <label class="flex items-center gap-2"><input type="checkbox" id="useInventory_Yeast" class="inventory-toggle rounded text-primary w-4 h-4 border-outline"> Yeast</label>
                <label class="flex items-center gap-2"><input type="checkbox" id="useInventory_Nutrients" class="inventory-toggle rounded text-primary w-4 h-4 border-outline"> Nutrients</label>
                <label class="flex items-center gap-2"><input type="checkbox" id="useInventory_Fruits" class="inventory-toggle rounded text-primary w-4 h-4 border-outline"> Fruit</label>
                <label class="flex items-center gap-2"><input type="checkbox" id="useInventory_Spices" class="inventory-toggle rounded text-primary w-4 h-4 border-outline"> Spices</label>
                <label class="flex items-center gap-2"><input type="checkbox" id="useInventory_Other" class="inventory-toggle rounded text-primary w-4 h-4 border-outline"> Other</label>
            </div>
            
            <div id="budget-section" class="hidden mt-2 pt-2 border-t border-outline-variant">
                <label class="flex items-center text-xs font-bold mb-2 text-on-surface gap-2">
                    <input type="checkbox" id="useBudget" class="rounded text-primary w-4 h-4 border-outline"> 
                    Set Budget Limit
                </label>
                <div id="budget-input-container" class="hidden">
                    <input type="number" id="maxBudget" placeholder="â‚¬20.00">
                </div>
            </div>
        </div>
    </details>

    <div class="mt-6">
        <button id="generateBtn" class="w-full bg-primary text-on-primary font-bold py-4 px-6 rounded-2xl shadow-elevation-1 hover:shadow-elevation-2 hover:scale-[1.02] active:scale-[0.98] transition-all text-lg tracking-widest uppercase flex items-center justify-center gap-3">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
    Generate Recipe
</button>
    </div>
</aside>

            <main class="lg:w-2/3 card p-8 shadow-elevation-1 overflow-y-auto border border-outline-variant/30" style="max-height: 75vh;">
                <div id="recipe-output" class="prose max-w-none text-on-surface h-full flex flex-col">
    <div class="flex flex-col items-center justify-center flex-grow p-8 text-center border-2 border-dashed border-outline-variant/50 rounded-3xl bg-surface-container-low/50 min-h-[400px]">
        <div class="w-24 h-24 bg-surface-container rounded-full flex items-center justify-center mb-6 shadow-sm">
            <svg class="w-12 h-12 text-outline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
        </div>
        <h3 class="text-xl font-bold text-on-surface mb-2">Ready to Brew?</h3>
        <p class="text-on-surface-variant max-w-xs mx-auto">Configure your preferences in the sidebar and click <span class="font-bold text-primary">Generate</span> to let the AI craft your recipe.</p>
    </div>
</div>
            </main>
        </div>
    </div>

            <div id="brew-day-1-view" class="hidden mt-6 animate-fade-in">
    <div class="card p-6 md:p-8 shadow-elevation-1 border border-outline-variant/30 min-h-[50vh]">
        <h3 class="text-xl font-header font-bold text-primary mb-4 flex items-center gap-3">
    <span class="w-10 h-10 rounded-full bg-primary-container text-on-primary-container flex items-center justify-center shadow-sm">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
    </span>
    Brew Day 1: Primary Fermentation
</h3>
        <div id="brew-day-content" class="text-on-surface"></div>
    </div>
</div>

<div id="brew-day-2-view" class="hidden mt-6 animate-fade-in">
    <div class="card p-6 md:p-8 shadow-elevation-1 border border-outline-variant/30 min-h-[50vh]">
        <h3 class="text-xl font-header font-bold text-primary mb-4 flex items-center gap-3">
    <span class="w-10 h-10 rounded-full bg-secondary-container text-on-secondary-container flex items-center justify-center shadow-sm">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
    </span>
    Brew Day 2: Racking & Aging
</h3>
        <div id="brew-day-2-content" class="text-on-surface"></div> </div>
</div>
            
            <div id="history-view" class="hidden mt-6 animate-fade-in">
     <div class="card p-6 md:p-8 shadow-elevation-1 border border-outline-variant/30 overflow-y-auto" style="max-height: 75vh;">
        <div id="history-list-container">
            <h2 class="text-3xl font-header font-normal mb-6 text-center text-primary">Brew History</h2>
            
            <div class="relative mb-6 max-w-lg mx-auto">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <svg class="h-5 w-5 text-on-surface-variant" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
                <input type="text" id="history-search-input" placeholder="Search brews..." 
                       class="w-full pl-12 pr-4 py-3 rounded-full bg-surface-variant/30 border-none focus:ring-2 focus:ring-primary focus:bg-surface-variant/50 text-on-surface placeholder-on-surface-variant transition-all shadow-sm">
            </div>

            <div id="history-list" class="space-y-3">
                </div>
        </div>
        
        <div id="history-detail-container" class="hidden">
            </div>
     </div>
</div>
            
            <div id="shopping-list-view" class="hidden mt-6 animate-fade-in">
                <div class="card p-6 md:p-8 shadow-elevation-1 border border-outline-variant/30">
                      <div class="flex items-center justify-center gap-3 mb-6">
    <span class="w-12 h-12 rounded-full bg-tertiary-container text-on-tertiary-container flex items-center justify-center shadow-sm">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
    </span>
    <h2 class="text-3xl font-header font-normal text-on-surface m-0 border-none">Shopping List</h2>
</div>
                      
                      <div id="shopping-list-container" class="mb-8">
                         <div id="shopping-list-content" class="p-0 bg-transparent">
                             </div>
                      </div>
                </div>
            </div> 
     </div> 

     <div id="management-main-view" class="hidden min-h-screen w-full flex flex-col">
         
         <div class="flex items-center justify-between mb-4 no-print">
             <button class="back-to-dashboard-btn flex items-center gap-2 text-primary font-bold hover:bg-surface-variant/20 px-4 py-2 rounded-full transition-colors text-sm uppercase tracking-wide">
                 <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                 Back to Dashboard
             </button>
         </div>

     <div class="mb-6 overflow-x-auto no-scrollbar py-1">
        <nav class="flex space-x-2 min-w-max p-1 bg-surface-container rounded-full border border-outline-variant w-fit mx-auto md:mx-0">
            <button id="inventory-sub-tab" class="sub-tab active">Inventory</button>
            <button id="equipment-sub-tab" class="sub-tab">Equipment</button>
            <button id="packaging-sub-tab" class="sub-tab">Packaging</button>
            <button id="cellar-sub-tab" class="sub-tab">Cellar</button>
            <button id="financials-sub-tab" class="sub-tab">Financials</button>
        </nav>
    </div>
            <div id="inventory-view" class="hidden mt-6 flex-grow w-full">
        <div class="flex flex-col lg:flex-row gap-6">
            
            <aside class="lg:w-1/3 card p-6 shadow-elevation-1 border border-outline-variant/50">
                
                <div id="barcode-scanner-container" class="relative hidden mb-6 rounded-2xl overflow-hidden shadow-elevation-2">
                    <div id="barcode-reader" class="w-full"></div>
                    <button id="close-scanner-btn" class="absolute top-2 right-2 bg-surface/80 text-on-surface rounded-full h-8 w-8 flex items-center justify-center font-bold backdrop-blur-sm hover:bg-error hover:text-white transition-colors">&times;</button>
                </div>

                <h2 class="text-2xl text-primary font-normal mb-6 flex items-center gap-2">
                    Add to Inventory
                </h2>
                
                <button id="scan-barcode-btn" class="w-full mb-6 bg-secondary-container text-on-secondary-container font-bold py-3 px-4 rounded-full hover:shadow-elevation-1 transition-all flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 17h.01M16 13h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    Scan Barcode
                </button>
                
                <form id="inventory-form" class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Name</label>
                        <input type="text" id="itemName" placeholder="Ingredient name...">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Qty</label>
                            <input type="number" id="itemQty" step="0.01" placeholder="0.00">
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Unit</label>
                            <select id="itemUnit">
                                <option>kg</option><option>g</option><option>L</option><option>ml</option><option>packets</option><option>items</option>
                            </select>
                        </div>
                    </div>
                     <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Price (â‚¬)</label>
                        <input type="number" id="itemPrice" step="0.01" placeholder="0.00">
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Category</label>
                        <select id="itemCategory">
                            <option>Honey</option><option>Yeast</option><option>Nutrient</option><option>Malt Extract</option><option>Fruit</option><option>Spice</option><option>Adjunct</option><option>Chemical</option><option>Water</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Exp. Date</label>
                        <input type="date" id="itemExpirationDate">
                    </div>
                    <button type="submit" class="w-full bg-primary text-on-primary font-bold py-3 px-6 rounded-full hover:shadow-elevation-2 active:scale-95 transition-all mt-2">
                        Add Ingredient
                    </button>
                </form>
            </aside>
            
            <main class="lg:w-2/3 card p-6 md:p-8 shadow-elevation-1 border border-outline-variant/30 inventory-panel overflow-y-auto" style="max-height: 75vh;">
                <h2 class="text-2xl text-primary font-normal mb-6 text-center">Current Stock</h2>
                <div id="inventory-list" class="space-y-2">
                    </div>
            </main>
        </div>
    </div>

            <div id="packaging-view" class="hidden mt-6 animate-fade-in">
        <div class="flex flex-col lg:flex-row gap-6">
            <aside class="lg:w-1/3 card p-6 border border-outline-variant/50">
                <h2 class="text-2xl text-primary font-normal mb-6">Packaging Stock</h2>
                <form id="packaging-add-form" class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Material</label>
                        <select id="packaging-item-select"></select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Qty</label>
                            <input type="number" id="packaging-item-qty" placeholder="0">
                        </div>
                       <div>
                            <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Price (â‚¬)</label>
                            <input type="number" id="packaging-item-price" placeholder="0.00">
                       </div>
                    </div>
                    <button type="submit" class="w-full bg-primary text-on-primary font-bold py-3 px-4 rounded-full hover:shadow-elevation-2 transition-all mt-2">Add</button>
                </form>
            </aside>
            <main id="packaging-stock-container" class="lg:w-2/3 card p-6 md:p-8 border border-outline-variant/30 inventory-panel">
                <h2 class="text-2xl text-primary font-normal mb-6 text-center">Current Packaging</h2>
                <div id="packaging-list"></div>
            </main>
        </div>
    </div>             

    <div id="equipment-view" class="hidden mt-6 animate-fade-in">
        <div class="flex flex-col lg:flex-row gap-6">
            <aside class="lg:w-1/3 card p-6 border border-outline-variant/50">
                <h2 class="text-2xl text-primary font-normal mb-6">Add Equipment</h2>
                <form id="equipment-profile-form" class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Name</label>
                        <input type="text" id="equipProfileName" placeholder="e.g. 10L Bucket">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Type</label>
                            <select id="equipProfileType"><option value="Fermenter">Fermenter</option><option value="Kettle">Kettle</option></select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Qty</label>
                            <input type="number" id="equipProfileQuantity" value="1">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Cap (L)</label>
                            <input type="number" id="equipCapacityLiters" placeholder="0">
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Loss (L)</label>
                            <input type="number" id="trubLossLiters" placeholder="0">
                        </div>
                    </div>
                    <div id="boil-off-rate-container" class="hidden">
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Boil-Off (L/hr)</label>
                        <input type="number" id="boilOffRateLitersPerHour">
                    </div>
                    <button type="submit" class="w-full bg-primary text-on-primary font-bold py-3 px-4 rounded-full hover:shadow-elevation-2 transition-all mt-2">Add</button>
                </form>
            </aside>
            <main class="lg:w-2/3 card p-6 md:p-8 border border-outline-variant/30 inventory-panel">
                <h2 class="text-2xl text-primary font-normal mb-6 text-center">Equipment Profiles</h2>
                <div id="equipment-profiles-list"></div>
            </main>
        </div>
    </div>

            <div id="cellar-view" class="hidden mt-6 animate-fade-in">
        <div class="card p-6 md:p-8 shadow-elevation-1 border border-outline-variant/30 overflow-y-auto" style="max-height: 75vh;">
            <h2 class="text-2xl text-primary font-normal mb-6">My Cellar</h2>
            <div id="cellar-list" class="space-y-4"></div>
        </div>
    </div>

    <div id="financials-view" class="hidden mt-6 animate-fade-in">
        <div class="card p-6 md:p-8 shadow-elevation-1 border border-outline-variant/30 overflow-y-auto" style="max-height: 75vh;">
             <h2 class="text-2xl text-primary font-normal mb-6">Financial Overview</h2>
             
             <div id="cost-analysis-container">
                
                <div class="mb-8 p-8 rounded-3xl bg-primary-container text-on-primary-container text-center shadow-elevation-1 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-primary opacity-10 rounded-full -mr-10 -mt-10"></div>
                    <h4 class="text-sm font-bold uppercase tracking-widest mb-2 opacity-80">Total Brewery Asset Value</h4>
                    <p id="grand-total-value" class="text-6xl font-header font-medium tracking-tight">â‚¬0.00</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    
                    <div onclick="switchMainView('management'); switchSubView('inventory', 'management-main-view')" 
                         class="card p-5 text-center cursor-pointer hover:shadow-elevation-2 transition-all duration-200 group relative overflow-hidden border border-outline-variant/50">
                        <div class="absolute top-0 left-0 w-full h-1 bg-tertiary"></div>
                        <h4 class="text-xs font-bold text-on-surface-variant uppercase tracking-wider mb-2">Inventory</h4>
                        <p id="total-inventory-value" class="text-2xl font-bold text-tertiary">â‚¬0.00</p>
                        <p class="text-[10px] text-primary mt-2 uppercase font-bold opacity-0 group-hover:opacity-100 transition-opacity">Go to Stock &rarr;</p>
                    </div>

                    <div onclick="switchMainView('brewing'); switchSubView('history', 'brewing-main-view')" 
                         class="card p-5 text-center cursor-pointer hover:shadow-elevation-2 transition-all duration-200 group relative overflow-hidden border border-outline-variant/50">
                        <div class="absolute top-0 left-0 w-full h-1 bg-primary"></div>
                        <h4 class="text-xs font-bold text-on-surface-variant uppercase tracking-wider mb-2">In Progress</h4>
                        <p id="total-active-value" class="text-2xl font-bold text-primary">â‚¬0.00</p>
                        <p class="text-[10px] text-primary mt-2 uppercase font-bold opacity-0 group-hover:opacity-100 transition-opacity">View Batches &rarr;</p>
                    </div>

                    <div onclick="switchMainView('management'); switchSubView('cellar', 'management-main-view')" 
                         class="card p-5 text-center cursor-pointer hover:shadow-elevation-2 transition-all duration-200 group relative overflow-hidden border border-outline-variant/50">
                        <div class="absolute top-0 left-0 w-full h-1 bg-secondary"></div>
                        <h4 class="text-xs font-bold text-on-surface-variant uppercase tracking-wider mb-2">Cellar</h4>
                        <p id="total-cellar-value" class="text-2xl font-bold text-secondary">â‚¬0.00</p>
                        <p class="text-[10px] text-primary mt-2 uppercase font-bold opacity-0 group-hover:opacity-100 transition-opacity">Open Cellar &rarr;</p>
                    </div>
                </div>

                <div class="card p-6 border border-outline-variant/50">
                    <h4 class="text-lg font-bold text-on-surface mb-6">Spend by Category</h4>
                    <div class="h-64"><canvas id="cost-chart"></canvas></div>
                </div>
             </div>
        </div>
    </div>
</div> 

        <div id="tools-main-view" class="hidden">
    
    <div class="flex items-center justify-between mb-4 no-print">
        <button class="back-to-dashboard-btn flex items-center gap-2 text-primary font-bold hover:bg-surface-variant/20 px-4 py-2 rounded-full transition-colors text-sm uppercase tracking-wide">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            Back to Dashboard
        </button>
    </div>
    
    <div class="mb-6 overflow-x-auto no-scrollbar py-1">
        <nav class="flex space-x-2 min-w-max p-1 bg-surface-container rounded-full border border-outline-variant w-fit mx-auto md:mx-0">
            <button id="calculators-sub-tab" class="sub-tab active">Calculators</button>
            <button id="labels-sub-tab" class="sub-tab">Labels</button>
            <button id="water-sub-tab" class="sub-tab">Water</button>
            <button id="troubleshoot-sub-tab" class="sub-tab">Mead Medic</button>
            <button id="social-sub-tab" class="sub-tab">Social</button>
            <button id="library-sub-tab" class="sub-tab">Library</button>
        </nav>
    </div>
    
    <div id="calculators-view" class="hidden bg-surface-container card p-6 md:p-8 shadow-elevation-1 overflow-y-auto animate-fade-in" style="max-height: 80vh;">
        <h2 class="text-3xl font-header font-normal mb-6 text-center text-primary">Calculators</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            
            <div class="p-6 rounded-3xl bg-surface border border-outline-variant/50 hover:shadow-elevation-2 transition-shadow">
                <div class="flex items-center gap-3 mb-4">
                    <span class="w-10 h-10 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center font-bold">AVG</span>
                    <h3 class="text-lg font-bold text-on-surface m-0">ABV Calculator</h3>
                </div>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">OG (Start)</label>
                            <input type="number" id="og" step="0.001" placeholder="1.100">
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">FG (End)</label>
                            <input type="number" id="fg" step="0.001" placeholder="1.000">
                        </div>
                    </div>
                    <button id="calcAbvBtn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-full hover:brightness-110 transition-all">Calculate ABV</button>
                    <div id="abvResult" class="text-center font-bold text-xl text-blue-700 mt-2 h-10 flex items-center justify-center bg-blue-50 rounded-xl"></div>
                </div>
            </div>

            <div class="p-6 rounded-3xl bg-surface border border-outline-variant/50 hover:shadow-elevation-2 transition-shadow">
                <div class="flex items-center gap-3 mb-4">
                    <span class="w-10 h-10 rounded-full bg-amber-100 text-amber-700 flex items-center justify-center font-bold">TMP</span>
                    <h3 class="text-lg font-bold text-on-surface m-0">Hydro Correction</h3>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Measured SG</label>
                        <input type="number" id="sgReading" step="0.001" placeholder="1.050">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Temp (Â°C)</label>
                            <input type="number" id="tempReading" placeholder="25">
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Calib (Â°C)</label>
                            <input type="number" id="calTemp" value="20">
                        </div>
                    </div>
                    <button id="correctSgBtn" class="w-full bg-amber-600 text-white font-bold py-3 px-4 rounded-full hover:brightness-110 transition-all">Correct SG</button>
                    <div id="sgResult" class="text-center font-bold text-xl text-amber-700 mt-2 h-10 flex items-center justify-center bg-amber-50 rounded-xl"></div>
                </div>
            </div>

            <div class="p-6 rounded-3xl bg-surface border border-outline-variant/50 hover:shadow-elevation-2 transition-shadow">
                <div class="flex items-center gap-3 mb-4">
                    <span class="w-10 h-10 rounded-full bg-purple-100 text-purple-700 flex items-center justify-center font-bold">BRIX</span>
                    <h3 class="text-lg font-bold text-on-surface m-0">Refractometer</h3>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Original Brix</label>
                        <input type="number" id="refract_ob" placeholder="22" step="0.1">
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Current Brix</label>
                        <input type="number" id="refract_cb" placeholder="9" step="0.1">
                    </div>
                    <button id="calcRefractBtn" class="w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-full hover:brightness-110 transition-all">Calculate Gravity</button>
                    <div id="refractResult" class="hidden mt-2 p-3 bg-purple-50 rounded-xl text-center text-purple-700 font-medium"></div>
                </div>
            </div>

            <div class="p-6 rounded-3xl bg-surface border border-outline-variant/50 hover:shadow-elevation-2 transition-shadow md:col-span-2 xl:col-span-3">
                <div class="flex items-center gap-3 mb-4">
                    <span class="w-10 h-10 rounded-full bg-green-100 text-green-700 flex items-center justify-center font-bold">NUT</span>
                    <h3 class="text-lg font-bold text-on-surface m-0">TOSNA 2.0 (Nutrients)</h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">OG</label>
                        <input type="number" id="tosna_og" step="0.001" placeholder="1.100">
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Batch Vol (L)</label>
                        <input type="number" id="tosna_vol" placeholder="5">
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Yeast Type</label>
                        <select id="tosna_yeast">
                            <option value="low">Low (e.g. 71B)</option>
                            <option value="medium" selected>Medium (e.g. D47)</option>
                            <option value="high">High (e.g. RC-212)</option>
                        </select>
                    </div>
                </div>
                <button id="calcTosnaBtn" class="w-full mt-6 bg-green-600 text-white font-bold py-3 px-4 rounded-full hover:brightness-110 transition-all">Calculate Schedule</button>
                <div id="tosnaResult" class="mt-4 bg-green-50 p-4 rounded-xl hidden empty:hidden text-green-900 border border-green-200"></div>
            </div>
            
            <div class="p-6 rounded-3xl bg-surface border border-outline-variant/50 hover:shadow-elevation-2 transition-shadow">
                 <h3 class="text-lg font-bold text-on-surface mb-4">Blend / Fortify</h3>
                 <div class="space-y-3">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" id="vol1" placeholder="Base L">
                        <input type="number" id="abv1" placeholder="Base %">
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" id="vol2" placeholder="Add L">
                        <input type="number" id="abv2" placeholder="Add %">
                    </div>
                    <button id="calcBlendBtn" class="w-full bg-primary text-on-primary font-bold py-2 px-4 rounded-full mt-2">Calculate New ABV</button>
                    <div id="blendResult" class="text-center font-bold text-sm text-primary mt-2 h-8 flex items-center justify-center"></div>
                 </div>
             </div>
             
             <div class="p-6 rounded-3xl bg-surface border border-outline-variant/50 hover:shadow-elevation-2 transition-shadow">
                <h3 class="text-lg font-bold text-on-surface mb-4">Backsweetening</h3>
                <div class="space-y-3">
                    <input type="number" id="bs_current_vol" placeholder="Vol (L)">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" id="bs_current_sg" placeholder="Cur SG">
                        <input type="number" id="bs_target_sg" placeholder="Target SG">
                    </div>
                    <button id="calcBacksweetenBtn" class="w-full bg-primary text-on-primary font-bold py-2 px-4 rounded-full mt-2">Calculate Honey</button>
                    <div id="backsweetenResult" class="text-center font-bold text-sm text-primary mt-2 h-8 flex items-center justify-center"></div>
                </div>
            </div>

            <div class="p-6 rounded-3xl bg-surface border border-outline-variant/50 hover:shadow-elevation-2 transition-shadow">
                <h3 class="text-lg font-bold text-on-surface mb-4">Dilution</h3>
                <div class="space-y-3">
                    <input type="number" id="dil_start_vol" placeholder="Vol (L)">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" id="dil_start_sg" placeholder="Start SG">
                        <input type="number" id="dil_target_sg" placeholder="Target SG">
                    </div>
                    <button id="calcDilutionBtn" class="w-full bg-primary text-on-primary font-bold py-2 px-4 rounded-full mt-2">Calculate Water</button>
                    <div id="dilutionResult" class="text-center font-bold text-sm text-primary mt-2 h-8 flex items-center justify-center"></div>
                </div>
            </div>
        </div>
    </div>
 
    <div id="labels-view" class="hidden mt-6 animate-fade-in">
        <span id="displayLabelYeast" class="hidden"></span>
        <span id="displayLabelHoney" class="hidden"></span>
        <input type="hidden" id="labelDetails">

        <div class="flex flex-col md:flex-row gap-6 h-[85vh]">
            
            <aside class="w-full md:w-1/3 h-full card p-6 overflow-y-auto border border-outline-variant/50 no-scrollbar">
    <h2 class="text-2xl font-header font-normal mb-6 flex items-center gap-2 text-primary">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path></svg>
        Label Forge
    </h2>
    
    <div class="mb-6">
        <label class="text-xs font-bold uppercase text-on-surface-variant mb-2 block tracking-wider">Data Source</label>
        <select id="labelRecipeSelect" class="w-full bg-surface-container border-outline-variant text-sm rounded-xl"></select>
    </div>

    <div class="space-y-4 mb-6 pt-4 border-t border-outline-variant">
        <label class="text-xs font-bold uppercase text-on-surface-variant mb-2 block tracking-wider">Design Theme</label>
        <div class="grid grid-cols-2 gap-2 mb-4">
            <button class="label-theme-btn active btn bg-secondary-container text-on-secondary-container border-none py-2 rounded-xl text-xs font-bold" data-theme="standard">Standard</button>
            <button class="label-theme-btn btn bg-surface border border-outline text-on-surface py-2 rounded-xl text-xs font-bold" data-theme="special">Special</button>
        </div>
        
        <div class="mt-4 p-3 bg-primary-container/10 rounded-2xl border border-primary/10">
            <label class="text-[10px] font-bold uppercase text-primary mb-2 block tracking-widest">AI Artwork Style</label>
            <select id="labelArtStyle" class="w-full mb-3 text-xs bg-surface border-outline-variant rounded-lg p-2 font-medium">
                <option value="">-- Use Default Style --</option>
            </select>
            <div class="flex gap-2">
                <button id="ai-label-art-btn" class="flex-grow bg-purple-600 text-white font-bold py-2.5 px-3 rounded-full hover:brightness-110 flex items-center justify-center gap-2 text-xs transition-all shadow-sm">
                    <span class="text-sm">âœ¨</span> Generate Art
                </button>
                <button onclick="window.openArtGallery()" class="bg-blue-600 text-white font-bold py-2.5 px-4 rounded-full text-xs shadow-sm hover:brightness-110">ðŸ–¼ï¸</button>
                <label class="cursor-pointer bg-surface border border-outline text-on-surface font-bold py-2.5 px-4 rounded-full hover:bg-surface-variant text-xs flex items-center shadow-sm">
                    ðŸ“‚ <input type="file" id="logoUpload" accept="image/*" class="hidden">
                </label>
            </div>
            
            <div id="art-actions" class="hidden grid grid-cols-3 gap-2 mt-3">
                 <button onclick="window.saveArtToCloud()" class="bg-blue-100 text-blue-700 text-[9px] font-bold py-2 px-1 rounded-full uppercase border border-blue-200">â˜ï¸ Save</button>
                 <button onclick="window.downloadLabelArt()" class="bg-green-100 text-green-700 text-[9px] font-bold py-2 px-1 rounded-full uppercase border border-green-200">ðŸ’¾ Dwnl</button>
                 <button onclick="window.clearLabelArt()" class="bg-red-100 text-red-700 text-[9px] font-bold py-2 px-1 rounded-full uppercase border border-red-200">âœ• Clear</button>
            </div>
        </div>
    </div>

    <div class="space-y-3 mb-6 pt-4 border-t border-outline-variant">
    <label class="text-xs font-bold uppercase text-on-surface-variant mb-2 block tracking-wider">Label Content</label>
    <div class="grid grid-cols-2 gap-2">
        <input type="text" id="labelTitle" placeholder="Batch Title" class="text-sm">
        <input type="text" id="labelSubtitle" placeholder="Mead Style" class="text-sm">
    </div>
    <div class="grid grid-cols-4 gap-2">
        <input type="text" id="labelAbv" placeholder="ABV%" class="text-xs text-center">
        <input type="text" id="labelFg" placeholder="FG" class="text-xs text-center">
        <input type="text" id="labelVol" placeholder="ml" class="text-xs text-center">
        <input type="text" id="labelDate" placeholder="Date" class="text-xs text-center">
    </div>

    <div class="p-3 bg-surface-variant/5 rounded-xl border border-outline-variant/30 space-y-3 mt-2">
        <div class="flex items-center justify-between text-[10px] font-bold uppercase text-on-surface-variant">
            <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" id="labelShowHoney" class="rounded text-primary" checked> Honey
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" id="labelShowYeast" class="rounded text-primary" checked> Yeast
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" id="labelShowDetails" class="rounded text-primary"> Details
            </label>
        </div>
        <div>
            <label class="text-[9px] font-bold uppercase text-on-surface-variant mb-1 block">Allergens / Warnings</label>
            <input type="text" id="labelAllergens" placeholder="e.g. Contains Sulfites" class="w-full text-[10px] p-2 bg-surface border-outline-variant rounded-lg">
        </div>
    </div>
    
    <div class="mt-4 pt-2 border-t border-outline-variant/30">
        <div class="flex justify-between items-center mb-2">
            <label class="text-[10px] font-bold text-on-surface-variant uppercase tracking-widest">Back Story Tone</label>
            <button id="ai-label-desc-btn" class="bg-purple-600 text-white text-[10px] font-bold uppercase py-1.5 px-3 rounded-full shadow-sm hover:scale-105 transition-transform">âœ¨ AI Write</button>
        </div>
        <select id="label-persona-select" class="w-full mb-2 text-xs bg-surface-container-low border-outline-variant rounded-lg p-2 font-bold text-primary">
            <option value="Witty">The Witty Brewer (Default)</option>
            <option value="Ryan Reynolds">Ryan Reynolds Style</option>
            <option value="The Sommelier">The Sommelier (Elegant)</option>
            <option value="Dry British">Dry British (Cynical)</option>
            <option value="The Viking">The Viking (Epic)</option>
        </select>
        <textarea id="labelDescription" rows="3" class="w-full text-xs p-3 rounded-xl bg-surface-container-lowest border-outline-variant" placeholder="Short description..."></textarea>
    </div>
</div>

    <div class="pt-4 border-t border-outline-variant">
        <details class="group">
            <summary class="flex justify-between items-center cursor-pointer text-xs font-bold text-primary uppercase tracking-wider select-none p-2 hover:bg-surface-variant/10 rounded-lg transition-colors">
                <span>Fine-Tune Layout</span>
                <svg class="w-4 h-4 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </summary>
            
            <div class="pt-4 space-y-2 px-1">
                 
                 <details class="group/inner bg-surface-variant/5 rounded-lg border border-outline-variant/20 overflow-hidden">
                    <summary class="flex justify-between items-center cursor-pointer text-[10px] font-bold uppercase text-on-surface-variant p-3 bg-surface-variant/10 hover:bg-surface-variant/20">
    <span>Title & Typography</span>
    <span class="text-xs text-primary font-bold">
        <span class="group-open/inner:hidden">+</span>
        <span class="hidden group-open/inner:inline">âˆ’</span>
    </span>
</summary>
                    <div class="p-3 space-y-4">
                        <div>
                            <div class="flex justify-between text-[10px] font-bold uppercase text-on-surface-variant mb-1">
                                <span>Main Title Font</span>
                                <input type="color" id="tuneTitleColor" class="w-4 h-4 p-0 border-none bg-transparent cursor-pointer" value="#8F8C79">
                            </div>
                            <select id="tuneTitleFont" class="w-full text-xs p-1 rounded border border-outline-variant bg-surface mb-2"></select>
                            
                            <div class="grid grid-cols-2 gap-x-4 gap-y-2">
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Size 1 <span id="disp-title-size">100px</span></label>
                                    <input type="range" id="tuneTitleSize" min="10" max="200" value="100" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Size 2 <span id="disp-title-size-2">60px</span></label>
                                    <input type="range" id="tuneTitleSize2" min="10" max="200" value="60" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Pos X <span id="disp-title-x">10%</span></label>
                                    <input type="range" id="tuneTitleX" min="0" max="100" value="10" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Pos Y <span id="disp-title-y">10%</span></label>
                                    <input type="range" id="tuneTitleY" min="0" max="100" value="10" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Rotate <span id="disp-title-rotate">0Â°</span></label>
                                    <input type="range" id="tuneTitleRotate" min="-180" max="180" value="0" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Split Word <span id="disp-title-break">8</span></label>
                                    <input type="range" id="tuneTitleBreak" min="1" max="8" value="8" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Offset X <span id="disp-title-offset">0%</span></label>
                                    <input type="range" id="tuneTitleOffset" min="-100" max="100" value="0" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Offset Y <span id="disp-title-offset-y">0%</span></label>
                                    <input type="range" id="tuneTitleOffsetY" min="-100" max="100" value="0" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                            </div>
                        </div>
                    </div>
                 </details>

                 <details class="group/inner bg-surface-variant/5 rounded-lg border border-outline-variant/20 overflow-hidden">
                    <summary class="flex justify-between items-center cursor-pointer text-[10px] font-bold uppercase text-on-surface-variant p-3 bg-surface-variant/10 hover:bg-surface-variant/20">
                        <span>Style & Subtitle</span>
                        <span class="text-xs text-primary">+</span>
                    </summary>
                    <div class="p-3 space-y-4">
                        <div>
                            <div class="flex justify-between text-[10px] font-bold uppercase text-on-surface-variant mb-1">
                                <span>Subtitle Font</span>
                                <input type="color" id="tuneStyleColor" class="w-4 h-4 p-0 border-none bg-transparent cursor-pointer" value="#9ca3af">
                            </div>
                            <select id="tuneStyleFont" class="w-full text-xs p-1 rounded border border-outline-variant bg-surface mb-2"></select>
                            <div class="grid grid-cols-2 gap-x-4 gap-y-2">
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Size 1 <span id="disp-style-size">14px</span></label>
                                    <input type="range" id="tuneStyleSize" min="5" max="100" value="14" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Size 2 <span id="disp-style-size-2">10px</span></label>
                                    <input type="range" id="tuneStyleSize2" min="5" max="100" value="10" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Gap/X <span id="disp-style-gap">5%</span></label>
                                    <input type="range" id="tuneStyleGap" min="0" max="100" value="5" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Pos Y <span id="disp-style-y">0%</span></label>
                                    <input type="range" id="tuneStyleY" min="-100" max="100" value="0" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Rotate <span id="disp-style-rotate">0Â°</span></label>
                                    <input type="range" id="tuneStyleRotate" min="-180" max="180" value="0" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Split Word <span id="disp-style-break">8</span></label>
                                    <input type="range" id="tuneStyleBreak" min="1" max="8" value="8" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Offset X <span id="disp-style-offset">0%</span></label>
                                    <input type="range" id="tuneStyleOffset" min="-100" max="100" value="0" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Offset Y <span id="disp-style-offset-y">0%</span></label>
                                    <input type="range" id="tuneStyleOffsetY" min="-100" max="100" value="0" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                            </div>
                        </div>
                    </div>
                 </details>

                 <details class="group/inner bg-surface-variant/5 rounded-lg border border-outline-variant/20 overflow-hidden">
                    <summary class="flex justify-between items-center cursor-pointer text-[10px] font-bold uppercase text-on-surface-variant p-3 bg-surface-variant/10 hover:bg-surface-variant/20">
                        <span>Art & Logo</span>
                        <span class="text-xs text-primary">+</span>
                    </summary>
                    <div class="p-3 space-y-4">
                        <div>
                            <p class="text-[10px] font-bold uppercase text-on-surface-variant mb-2">Background Artwork</p>
                            <div class="grid grid-cols-2 gap-x-4 gap-y-2">
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Zoom <span id="disp-art-zoom">1.00x</span></label>
                                    <input type="range" id="tuneArtZoom" min="0.5" max="3" step="0.1" value="1.0" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Opacity <span id="disp-art-opacity">100%</span></label>
                                    <input type="range" id="tuneArtOpacity" min="0" max="1" step="0.05" value="1" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Pos X <span id="disp-art-x">50%</span></label>
                                    <input type="range" id="tuneArtX" min="0" max="100" value="50" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Pos Y <span id="disp-art-y">50%</span></label>
                                    <input type="range" id="tuneArtY" min="0" max="100" value="50" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Rotate <span id="disp-art-rotate">0Â°</span></label>
                                    <input type="range" id="tuneArtRotate" min="-180" max="180" value="0" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                                <div class="space-y-1">
                                    <label class="flex justify-between text-[9px]">Overlay <span id="disp-art-overlay">0%</span></label>
                                    <input type="range" id="tuneArtOverlay" min="0" max="1" step="0.05" value="0" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                                </div>
                            </div>
                        </div>
                        <div class="pt-2 border-t border-outline-variant/30">
    <div class="flex justify-between text-[10px] font-bold uppercase text-on-surface-variant mb-2">
        <span>Meandery Logo</span>
        <div class="flex items-center gap-1">
            <label class="text-[8px]">Flat</label>
            <input type="checkbox" id="logoColorMode" class="w-3 h-3 text-primary rounded">
            <input type="color" id="tuneLogoColor" class="w-4 h-4 p-0 border-none bg-transparent cursor-pointer" value="#ffffff">
        </div>
    </div>
    <div class="grid grid-cols-2 gap-x-4 gap-y-2">
        <div class="space-y-1">
            <label class="flex justify-between text-[9px]">Size <span id="disp-logo-size">100px</span></label>
            <input type="range" id="tuneLogoSize" min="10" max="300" value="100" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
        </div>
        <div class="space-y-1">
            <label class="flex justify-between text-[9px]">Rotate <span id="disp-logo-rotate">0Â°</span></label>
            <input type="range" id="tuneLogoRotate" min="-180" max="180" value="0" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
        </div>
        <div class="space-y-1">
            <label class="flex justify-between text-[9px]">Pos X <span id="disp-logo-x">50%</span></label>
            <input type="range" id="tuneLogoX" min="0" max="100" value="50" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
        </div>
        <div class="space-y-1">
            <label class="flex justify-between text-[9px]">Pos Y <span id="disp-logo-y">10%</span></label>
            <input type="range" id="tuneLogoY" min="0" max="100" value="10" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
        </div>
    </div>
</div>
                    </div>
                 </details>

                 <details class="group/inner bg-surface-variant/5 rounded-lg border border-outline-variant/20 overflow-hidden">
                    <summary class="flex justify-between items-center cursor-pointer text-[10px] font-bold uppercase text-on-surface-variant p-3 bg-surface-variant/10 hover:bg-surface-variant/20">
                        <span>Data & Story</span>
                        <span class="text-xs text-primary">+</span>
                    </summary>
                    <div class="p-3 space-y-4">
                        <div>
                            <div class="flex justify-between text-[10px] font-bold uppercase text-on-surface-variant mb-1">
                                <span>Specs (ABV, Date...)</span>
                                <div class="flex gap-2">
                                    <input type="color" id="tuneSpecsColor" class="w-4 h-4 p-0 border-none bg-transparent cursor-pointer" value="#ffffff">
                                    <input type="color" id="tuneAllergenColor" class="w-4 h-4 p-0 border-none bg-transparent cursor-pointer" title="Allergen Color" value="#ff0000">
                                </div>
                            </div>
                            <div class="flex gap-1 mb-2">
                                <select id="tuneSpecsFont" class="w-2/3 text-[10px] p-1 rounded border border-outline-variant bg-surface"></select>
                                <select id="tuneSpecsAlign" class="w-1/3 text-[10px] p-1 rounded border border-outline-variant bg-surface">
                                    <option value="center">Center</option><option value="left">Left</option><option value="right">Right</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-x-4 gap-y-2">
    <div class="space-y-1">
        <label class="flex justify-between text-[9px]">Pos X <span id="disp-specs-x">50%</span></label>
        <input type="range" id="tuneSpecsX" min="0" max="100" value="50" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
    </div>
    <div class="space-y-1">
        <label class="flex justify-between text-[9px]">Pos Y <span id="disp-specs-y">80%</span></label>
        <input type="range" id="tuneSpecsY" min="0" max="100" value="80" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
    </div>
    <div class="space-y-1">
        <label class="flex justify-between text-[9px]">Rotate <span id="disp-specs-rotate">0Â°</span></label>
        <input type="range" id="tuneSpecsRotate" min="-180" max="180" value="0" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
    </div>
    <div class="space-y-1">
        <label class="flex justify-between text-[9px]">Size <span id="disp-specs-size">4px</span></label>
        <input type="range" id="tuneSpecsSize" min="1" max="20" step="0.5" value="4" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
    </div>
</div>
                        </div>
                        <div class="pt-2 border-t border-outline-variant/30">
                            <div class="flex justify-between text-[10px] font-bold uppercase text-on-surface-variant mb-1">
                                <span>Back Story</span>
                                <input type="color" id="tuneDescColor" class="w-4 h-4 p-0 border-none bg-transparent cursor-pointer" value="#ffffff">
                            </div>
                            <div class="flex gap-1 mb-2">
                                <select id="tuneDescFont" class="w-2/3 text-[10px] p-1 rounded border border-outline-variant bg-surface"></select>
                                <select id="tuneDescAlign" class="w-1/3 text-[10px] p-1 rounded border border-outline-variant bg-surface">
                                    <option value="center">Center</option><option value="left">Left</option><option value="right">Right</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-x-4 gap-y-2">
    <div class="space-y-1">
        <label class="flex justify-between text-[9px]">Pos X <span id="disp-desc-x">50%</span></label>
        <input type="range" id="tuneDescX" min="0" max="100" value="50" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
    </div>
    <div class="space-y-1">
        <label class="flex justify-between text-[9px]">Pos Y <span id="disp-desc-y">70%</span></label>
        <input type="range" id="tuneDescY" min="0" max="100" value="70" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
    </div>
    <div class="space-y-1">
        <label class="flex justify-between text-[9px]">Rotate <span id="disp-desc-rotate">0Â°</span></label>
        <input type="range" id="tuneDescRotate" min="-180" max="180" value="0" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
    </div>
    <div class="space-y-1">
        <label class="flex justify-between text-[9px]">Width <span id="disp-desc-width">60%</span></label>
        <input type="range" id="tuneDescWidth" min="10" max="100" value="60" class="w-full h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
    </div>
</div>
                        </div>
                    </div>
                 </details>

                 <div class="p-3 mt-2 bg-surface-variant/10 rounded-xl space-y-3 border border-outline-variant/20">
                    <div class="flex items-center justify-between">
                        <label class="text-[10px] font-bold uppercase text-on-surface-variant">Background Color</label>
                        <div class="flex items-center gap-2">
                            <span id="disp-background-color" class="text-[8px] font-mono opacity-60">#FFFFFF</span>
                            <input type="color" id="tuneBackgroundColor" class="w-6 h-6 rounded cursor-pointer border-none bg-transparent" value="#ffffff">
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <label class="text-[10px] font-bold uppercase text-on-surface-variant">Border Width <span id="disp-border-width" class="ml-1 opacity-60">3mm</span></label>
                        <input type="range" id="tuneBorderWidth" min="0" max="10" step="0.5" value="3" class="w-24 h-1 bg-outline-variant rounded-lg appearance-none cursor-pointer accent-primary">
                    </div>
                    <div class="flex items-center justify-between pt-2 border-t border-outline-variant/20">
                        <label class="text-[10px] font-bold uppercase text-on-surface-variant">Show White Border</label>
                        <input type="checkbox" id="labelShowBorder" class="rounded text-primary" checked>
                    </div>
                    <div class="flex items-center justify-between pt-2">
                        <label class="text-[10px] font-bold uppercase text-on-surface-variant">Show Cut Guides</label>
                        <input type="checkbox" id="labelShowGuides" class="rounded text-primary">
                    </div>
                 </div>
            </div>
            <button onclick="window.resetLabelLayout()" class="w-full mt-4 py-2 border border-outline-variant text-[10px] font-bold uppercase tracking-widest text-on-surface-variant hover:bg-error/10 hover:text-error hover:border-error/20 rounded-xl transition-all">Reset All Fine-Tuning</button>
        </details>
    </div>

    <div class="pt-4 mt-4 border-t border-outline-variant space-y-3">
        <div class="flex gap-2">
            <select id="labelPaper" class="flex-grow text-xs bg-surface border-outline-variant rounded-xl"></select>
            <button onclick="window.openLabelFormatModal()" class="bg-surface-variant text-on-surface-variant px-3 rounded-xl border border-outline-variant hover:bg-surface-variant/80">âš™ï¸</button>
        </div>
        <div class="grid grid-cols-2 gap-2">
            <button onclick="window.saveLabelToBrew()" class="bg-secondary-container text-on-secondary-container font-bold py-3 px-4 rounded-full flex items-center justify-center gap-2 text-sm shadow-sm active:scale-95 transition-all">
                ðŸ’¾ Save Label
            </button>
            <button id="printLabelsBtn" class="bg-primary text-on-primary font-bold py-3 px-4 rounded-full flex items-center justify-center gap-2 text-sm shadow-elevation-1 active:scale-95 transition-all">
                ðŸ–¨ï¸ Print
            </button>
        </div>
    </div>
</aside>
            
            <main class="w-full md:w-2/3 h-full bg-surface-container-lowest rounded-2xl shadow-inner flex flex-col relative overflow-hidden border border-outline-variant/30">
    <div class="absolute top-4 left-4 z-10 pointer-events-none">
        <p class="text-[10px] text-on-surface-variant/50 uppercase tracking-[0.2em] font-bold">Live Preview</p>
    </div>
    
    <div class="flex-grow flex items-center justify-center overflow-hidden relative w-full p-4 md:p-12">
        <div id="label-preview-container" class="bg-white text-black shadow-2xl relative overflow-hidden flex-shrink-0 origin-center" style="width: 99.1mm; height: 67.7mm; padding: 0;">
            <div id="label-content" class="relative w-full h-full bg-white overflow-hidden flex font-sans"></div>
        </div>
    </div>
</main>
        </div>
    </div>

    <div id="water-view" class="hidden mt-6 animate-fade-in">
        <div class="flex flex-col lg:flex-row gap-6">
            <aside class="lg:w-1/3 card p-6 border border-outline-variant/50">
                <h2 class="text-2xl text-primary font-normal mb-6">Water Chemistry</h2>
                <div class="mb-6">
                    <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Current Source</label>
                    <select id="waterSource" class="w-full"></select>
                </div>
                
                <div id="waterProfileDisplay" class="mb-6 p-4 rounded-2xl bg-blue-50 border border-blue-100">
                    <h4 class="text-xs font-bold text-blue-800 mb-3 uppercase tracking-wider text-center">Active Profile (ppm)</h4>
                    <div class="grid grid-cols-3 gap-y-4 gap-x-2 text-center">
                        <div><span class="block text-[10px] font-bold text-blue-600">Ca</span><span id="val-ca" class="text-lg font-bold text-blue-900">--</span></div>
                        <div><span class="block text-[10px] font-bold text-blue-600">Mg</span><span id="val-mg" class="text-lg font-bold text-blue-900">--</span></div>
                        <div><span class="block text-[10px] font-bold text-blue-600">Na</span><span id="val-na" class="text-lg font-bold text-blue-900">--</span></div>
                        <div><span class="block text-[10px] font-bold text-blue-600">SO4</span><span id="val-so4" class="text-lg font-bold text-blue-900">--</span></div>
                        <div><span class="block text-[10px] font-bold text-blue-600">Cl</span><span id="val-cl" class="text-lg font-bold text-blue-900">--</span></div>
                        <div><span class="block text-[10px] font-bold text-blue-600">HCO3</span><span id="val-hco3" class="text-lg font-bold text-blue-900">--</span></div>
                    </div>
                </div>
                
                <form id="water-profile-form" class="space-y-3 pt-6 border-t border-outline-variant">
                    <h4 class="font-bold text-on-surface">Add Profile</h4>
                    <input type="text" id="water-profile-name" placeholder="Profile Name">
                    <div class="grid grid-cols-3 gap-2">
                        <input type="number" id="manual_ca" placeholder="Ca">
                        <input type="number" id="manual_mg" placeholder="Mg">
                        <input type="number" id="manual_na" placeholder="Na">
                        <input type="number" id="manual_so4" placeholder="SO4">
                        <input type="number" id="manual_cl" placeholder="Cl">
                        <input type="number" id="manual_hco3" placeholder="HCO3">
                    </div>
                    <button type="submit" class="w-full bg-primary text-on-primary font-bold py-3 px-4 rounded-full mt-2">Save Profile</button>
                </form>
            </aside>
            <main class="lg:w-2/3 card p-6 md:p-8 border border-outline-variant/30">
                <h2 class="text-2xl text-primary font-normal mb-6 text-center">Water Sommelier</h2>
                <div class="mb-6 bg-surface-variant/20 p-6 rounded-3xl">
                    <p class="mb-4 text-on-surface">Select your water source and target style. AI will calculate additions.</p>
                    <div class="flex gap-4 items-end">
                        <div class="flex-grow">
                            <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Target</label>
                            <select id="meadTargetProfile">
                                <option value="balanced">Balanced Mead</option>
                                <option value="dry_traditional">Dry Traditional</option>
                                <option value="sweet_dessert">Sweet / Dessert</option>
                            </select>
                        </div>
                        <button id="getWaterAdviceBtn" class="bg-primary text-on-primary font-bold py-3 px-6 rounded-full shadow-elevation-1">Analyze</button>
                    </div>
                </div>
                <div id="water-advice-output" class="prose max-w-none text-on-surface"></div>
            </main>
        </div>
    </div>

    <div id="troubleshoot-view" class="hidden h-[75vh] flex flex-col animate-fade-in">
        <div class="card flex-grow flex flex-col p-4 shadow-elevation-1 border border-outline-variant/30 overflow-hidden">
            <div class="flex justify-between items-center mb-4 pb-2 border-b border-outline-variant">
                <h3 class="text-lg font-bold text-primary flex items-center gap-2">Mead Medic AI</h3>
                <button onclick="window.resetTroubleshootChat()" class="text-xs text-error font-bold uppercase hover:bg-error-container px-2 py-1 rounded">Clear</button>
            </div>

            <div id="chat-history" class="flex-grow overflow-y-auto mb-4 p-4 space-y-4 custom-scrollbar">
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 rounded-full bg-primary text-on-primary flex items-center justify-center font-bold text-xs">AI</div>
                    <div class="bg-surface-variant/30 p-3 rounded-2xl rounded-tl-none text-sm text-on-surface border border-outline-variant max-w-[85%]">
                        Hi! I'm your Mead Medic. What seems to be the problem?
                    </div>
                </div>
            </div>

            <div class="mt-auto relative">
                <div id="chat-image-preview" class="hidden mb-2 relative w-fit">
                    <img id="chat-preview-img" class="h-20 rounded-lg border border-outline">
                    <button onclick="window.clearChatImage()" class="absolute -top-2 -right-2 bg-error text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">&times;</button>
                </div>
                <div class="flex gap-2 items-center">
                    <label class="cursor-pointer flex items-center justify-center w-12 h-12 bg-surface-variant/30 hover:bg-primary-container rounded-full text-primary transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <input type="file" id="chat-image-input" accept="image/*" class="hidden" onchange="window.handleChatImageSelect(this)">
                    </label>
                    <input type="text" id="chat-input" class="flex-grow p-3 rounded-full bg-surface-variant/20 border-none focus:ring-2 focus:ring-primary" placeholder="Describe the issue..." onkeypress="if(event.key === 'Enter') window.sendTroubleshootMessage()">
                    <button onclick="window.sendTroubleshootMessage()" id="chat-send-btn" class="w-12 h-12 bg-primary text-on-primary rounded-full flex items-center justify-center shadow-elevation-1 hover:scale-105 transition-transform">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="social-view" class="hidden mt-6 animate-fade-in">
        <div class="flex flex-col lg:flex-row gap-6">
            <aside class="lg:w-1/3 card p-6 border border-outline-variant/50">
                <h2 class="text-2xl text-primary font-normal mb-6">Social Studio</h2>
                <div class="space-y-4">
                    <div><label class="block text-xs font-bold uppercase mb-1 ml-1 text-on-surface-variant">Recipe</label><select id="social-recipe-select" class="w-full"></select></div>
                    <div><label class="block text-xs font-bold uppercase mb-1 ml-1 text-on-surface-variant">Persona</label><select id="social-persona" class="w-full"><option>Ryan Reynolds</option><option>The Sommelier</option></select></div>
                    <div><label class="block text-xs font-bold uppercase mb-1 ml-1 text-on-surface-variant">Platform</label><select id="social-platform" class="w-full"><option>Instagram</option><option>Untappd</option></select></div>
                    <button id="generate-social-from-recipe-btn" class="w-full bg-primary text-on-primary font-bold py-3 px-4 rounded-full mt-4 hover:shadow-elevation-2">Draft Post</button>
                </div>
            </aside>
            <main class="lg:w-2/3 flex justify-center items-start">
                <div class="relative w-full max-w-sm bg-black rounded-[2.5rem] p-3 shadow-2xl border-4 border-gray-800">
                    <div class="bg-white dark:bg-gray-900 rounded-[2rem] overflow-hidden h-[600px] flex flex-col relative">
                        <div id="social-image-container" class="w-full aspect-square bg-gray-100 flex items-center justify-center relative">
                            <span class="text-gray-400 text-xs">Image Preview</span>
                            <button id="generate-social-image-btn" class="hidden absolute bottom-4 right-4 bg-white/90 text-black text-xs font-bold py-2 px-3 rounded-full shadow-lg">âœ¨ AI Generate</button>
                        </div>
                        <div class="p-4 flex-grow overflow-y-auto">
                            <div id="social-content-container" class="text-sm leading-relaxed text-gray-800 dark:text-gray-200"></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="library-view" class="hidden mt-6 animate-fade-in">
        <div class="card p-6 md:p-8 shadow-elevation-1 overflow-y-auto" style="max-height: 80vh;">
            <h2 class="text-3xl font-header font-normal mb-2 text-center text-primary">The Great Library</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8">
                <a href="https://scottlab.com/content/files/documents/handbooks/Scott-Labs-Handbook-2024.pdf" target="_blank" class="p-6 rounded-3xl bg-surface border border-outline-variant/50 hover:bg-surface-container hover:shadow-elevation-2 transition-all group no-underline">
                    <div class="flex items-center gap-3 mb-4">
                        <span class="w-10 h-10 rounded-full bg-primary-container text-on-primary-container flex items-center justify-center font-bold">PDF</span>
                        <h4 class="text-lg font-bold text-on-surface group-hover:text-primary transition-colors">Scott Labs Handbook</h4>
                    </div>
                    <p class="text-sm text-on-surface-variant mb-4">The fermentation bible. Detailed data on yeast strains and nutrients.</p>
                </a>
                <a href="https://denardbrewing.com/blog/post/BOMM5-acres/" target="_blank" class="p-6 rounded-3xl bg-surface border border-outline-variant/50 hover:bg-surface-container hover:shadow-elevation-2 transition-all group no-underline">
                    <div class="flex items-center gap-3 mb-4">
                         <span class="w-10 h-10 rounded-full bg-amber-100 text-amber-700 flex items-center justify-center font-bold">WEB</span>
                        <h4 class="text-lg font-bold text-on-surface group-hover:text-primary transition-colors">BOMM Protocol</h4>
                    </div>
                    <p class="text-sm text-on-surface-variant mb-4">Bray's One Month Mead. The gold standard for fast, clean fermentation.</p>
                </a>
            </div>
        </div>
    </div>
</div>

     <div id="settings-main-view" class="hidden">
    
    <div class="flex items-center justify-between mb-4 no-print">
        <button class="back-to-dashboard-btn flex items-center gap-2 text-primary font-bold hover:bg-surface-variant/20 px-4 py-2 rounded-full transition-colors text-sm uppercase tracking-wide">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            Back to Dashboard
        </button>
    </div>
    
    <div class="mb-6 overflow-x-auto no-scrollbar py-1">
        <nav class="flex space-x-2 min-w-max p-1 bg-surface-container rounded-full border border-outline-variant w-fit mx-auto md:mx-0">
            <button id="settings-general-sub-tab" class="sub-tab active" onclick="window.switchSubView('settings-general', 'settings-main-view')">General & AI</button>
            <button id="settings-assets-sub-tab" class="sub-tab" onclick="window.switchSubView('settings-assets', 'settings-main-view')">Label Assets</button>
            <button id="settings-data-sub-tab" class="sub-tab" onclick="window.switchSubView('settings-data', 'settings-main-view')">Data Zone</button>
        </nav>
    </div>

    <div id="settings-general-view" class="hidden card p-6 md:p-8 shadow-elevation-1 border border-outline-variant/30 overflow-y-auto animate-fade-in" style="max-height: 80vh;">
        <h2 class="text-3xl font-header font-normal mb-6 text-center text-primary">System Settings</h2>
        
        <div class="max-w-xl mx-auto space-y-6">
            
            <div class="p-6 rounded-3xl bg-surface border border-outline-variant/50">
                <div class="flex items-center gap-3 mb-4">
                    <span class="w-10 h-10 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center font-bold text-xs">AI</span>
                    <h3 class="text-lg font-bold text-on-surface m-0">Brain Power</h3>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Google AI Key</label>
                        <input type="password" id="apiKeyInput" placeholder="Enter API Key">
                    </div>
                    
                    <div class="pt-4 border-t border-outline-variant">
                        <div class="flex justify-between items-end mb-2">
                            <p class="text-xs font-bold text-on-surface-variant uppercase ml-1">Active Models</p>
                            <button id="fetchModelsBtn" class="bg-primary-container text-on-primary-container text-[10px] font-bold py-1 px-3 rounded-full hover:brightness-95 uppercase tracking-wider">
                                ðŸ”„ Scan
                            </button>
                        </div>
                        <div class="grid grid-cols-1 gap-3">
                            <div><p class="text-[10px] text-on-surface-variant mb-1 ml-1">Recipe Engine</p><select id="aiModelInput"><option value="gemini-2.0-flash">gemini-2.0-flash</option></select></div>
                            <div><p class="text-[10px] text-on-surface-variant mb-1 ml-1">Chat Engine</p><select id="chatModelInput"><option value="gemini-2.0-flash">gemini-2.0-flash</option></select></div>
                            <div><p class="text-[10px] text-on-surface-variant mb-1 ml-1">Image Engine</p><select id="imageModelInput"><option value="imagen-3.0-generate-001">imagen-3.0-generate-001</option></select></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-6 rounded-3xl bg-surface border border-outline-variant/50">
                 <div class="flex items-center gap-3 mb-4">
                    <span class="w-10 h-10 rounded-full bg-amber-100 text-amber-700 flex items-center justify-center font-bold text-xs">DEF</span>
                    <h3 class="text-lg font-bold text-on-surface m-0">Brewing Defaults</h3>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Batch Size (L)</label>
                        <input type="number" id="defaultBatchSizeInput">
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Currency</label>
                        <input type="text" id="defaultCurrencyInput">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Carbonation</label>
                    <select id="defaultCarbonationInput">
                            <option value="bottle">Bottle Conditioning</option>
                            <option value="keg">Keg / Force Carbonation</option>
                    </select>
                </div>
                
                <div class="pt-4 border-t border-outline-variant flex justify-between items-center">
                    <label class="font-bold text-on-surface ml-1">Dark Mode Interface</label>
                    <label class="theme-switch">
                        <input type="checkbox" id="theme-toggle-checkbox">
                        <div class="slider round"></div>
                    </label>
                </div>
            </div>

            <button id="saveSettingsBtn" class="w-full bg-primary text-on-primary font-bold py-3 px-4 rounded-full shadow-elevation-1 hover:brightness-110 transition-colors mt-2">
                Save System Settings
            </button>
        </div>
    </div>

    <div id="settings-assets-view" class="hidden card p-6 md:p-8 shadow-elevation-1 border border-outline-variant/30 overflow-y-auto animate-fade-in" style="max-height: 80vh;">
        <h2 class="text-3xl font-header font-normal mb-6 text-center text-primary">Label Assets</h2>
        <div class="max-w-xl mx-auto space-y-6">
            
            <div class="p-6 rounded-3xl bg-surface border border-outline-variant/50">
                <h3 class="text-lg font-bold text-on-surface mb-4">Prompt Engineer Tool</h3>
                <p class="text-xs text-on-surface-variant mb-4">Upload an image OR enter a designer name. AI will write a matching prompt.</p>

                <div class="mb-4">
                    <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">1. Artist / Style</label>
                    <input type="text" id="prompt-engineer-artist" placeholder="e.g. Art Nouveau, Cyberpunk...">
                </div>

                <div class="mb-4">
                    <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">2. Reference Image</label>
                    <div class="flex items-center gap-4">
                        <label class="cursor-pointer bg-surface-container border border-outline text-on-surface px-4 py-2 rounded-full flex items-center gap-2 hover:bg-surface-variant/20 transition-colors text-sm font-bold">
                            <span>ðŸ“‚ Upload</span>
                            <input type="file" id="prompt-engineer-upload" accept="image/*" class="hidden">
                        </label>
                        <div id="prompt-engineer-preview" class="w-12 h-12 bg-surface-variant/10 rounded-lg overflow-hidden hidden border border-outline">
                            <img id="pe-preview-img" class="w-full h-full object-cover">
                        </div>
                        <button onclick="window.clearPromptEngineerImage()" id="pe-clear-btn" class="hidden text-xs text-error font-bold hover:underline">Clear</button>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">3. Context</label>
                    <input type="text" id="prompt-engineer-context" placeholder="e.g. Make it darker...">
                </div>

                <button id="btn-analyze-prompt" class="w-full bg-primary-container text-on-primary-container font-bold py-3 px-4 rounded-full mb-4 hover:brightness-95">
                    âœ¨ Generate Prompt
                </button>

                <div id="prompt-engineer-output" class="hidden">
                    <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Result</label>
                    <textarea id="pe-result-text" rows="3" class="w-full font-mono text-sm" readonly></textarea>
                </div>
            </div>

            <div class="p-6 rounded-3xl bg-surface border border-outline-variant/50">
    <h3 class="text-lg font-bold text-on-surface mb-4">Custom Assets</h3>
    
    <div class="mb-8">
        <h4 class="font-bold text-xs text-primary uppercase mb-2 tracking-widest">A. Art Style Prompts</h4>
        <div class="flex gap-2 mb-4">
            <input type="text" id="newStyleName" placeholder="Style Name (e.g. Cyberpunk)" class="w-1/3 text-xs">
            <input type="text" id="newStylePrompt" placeholder="AI Prompt suffix..." class="flex-grow text-xs">
            <button id="addStyleBtn" onclick="window.addLabelStyle()" class="bg-primary text-on-primary w-12 rounded-xl font-bold text-xl flex items-center justify-center hover:brightness-110 shadow-sm">+</button>
        </div>
        <div id="settings-styles-list" class="space-y-2 max-h-40 overflow-y-auto no-scrollbar p-1">
            </div>
    </div>

    <div>
        <h4 class="font-bold text-xs text-secondary uppercase mb-2 tracking-widest">B. Typography (Google Fonts)</h4>
        <p class="text-[10px] text-on-surface-variant mb-3 px-1">Enter any valid name from fonts.google.com to import it.</p>
        <div class="flex gap-2 mb-4">
            <input type="text" id="newFontName" placeholder="e.g. Playfair Display or Roboto" class="flex-grow text-xs">
            <button id="addFontBtn" onclick="window.addLabelFont()" class="bg-secondary text-on-secondary w-12 rounded-xl font-bold text-xl flex items-center justify-center hover:brightness-110 shadow-sm">+</button>
        </div>
        <div id="settings-fonts-list" class="space-y-2 max-h-40 overflow-y-auto no-scrollbar p-1">
            </div>
    </div>
</div>
        </div>
    </div> 

    <div id="settings-data-view" class="hidden card p-6 md:p-8 shadow-elevation-1 border border-outline-variant/30 overflow-y-auto animate-fade-in" style="max-height: 80vh;">
        <h2 class="text-3xl font-header font-normal mb-6 text-center text-error">Danger Zone</h2>
        <div class="max-w-xl mx-auto">
            <div class="mt-4 p-6 rounded-3xl border border-error bg-error-container/10">
                <h3 class="text-xl font-header text-error mb-4 font-bold flex items-center gap-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                    Data Management
                </h3>
                <p class="text-sm text-on-surface-variant mb-6">Export your data for backup, or clear your local database permanently.</p>
                
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <button id="exportHistoryBtn" class="bg-surface-variant text-on-surface-variant hover:bg-surface-variant/80 font-bold py-3 rounded-full border border-outline-variant">Export History</button>
                    <button id="exportInventoryBtn" class="bg-surface-variant text-on-surface-variant hover:bg-surface-variant/80 font-bold py-3 rounded-full border border-outline-variant">Export Inv</button>
                    <button onclick="window.exportSystemLogs()" class="relative bg-surface-variant text-on-surface-variant hover:bg-surface-variant/80 font-bold py-3 rounded-full border border-outline-variant flex items-center justify-center gap-2">
    
                       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
    
                       <span>Debug Logs</span>

                       <span id="log-count-badge" class="hidden absolute -top-2 -right-2 bg-error text-white text-[10px] font-bold px-2 py-1 rounded-full border-2 border-surface shadow-sm animate-bounce">
        0
                       </span>
                   </button>
                </div>
                <div class="border-t border-error/20 pt-6 space-y-3">
                    <button id="clearHistoryBtn" class="w-full bg-error text-white py-3 rounded-full font-bold hover:brightness-110 shadow-sm">Delete ALL History</button>
                    <button id="clearInventoryBtn" class="w-full bg-error text-white py-3 rounded-full font-bold hover:brightness-110 shadow-sm">Delete ALL Inventory</button>
                </div>
            </div>
        </div>
    </div>

</div>

<div id="bottling-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 transition-opacity">
    <div class="bg-surface-container p-6 md:p-8 rounded-[28px] shadow-2xl w-full max-w-lg border border-outline-variant/50 animate-bounce-in max-h-[90vh] overflow-y-auto">
        <h3 class="text-2xl font-header font-normal mb-6 text-primary">Bottle Batch</h3>
        <form id="bottling-form">
            <div class="space-y-6">
                
                <div class="p-4 bg-secondary-container rounded-2xl border border-secondary-container">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-bold text-on-secondary-container text-xs uppercase tracking-wider flex items-center gap-2">
                            Peak Flavor Forecast
                        </h4>
                        <button type="button" onclick="window.analyzeAgingPotential()" class="text-[10px] bg-primary text-on-primary px-3 py-1.5 rounded-full hover:brightness-110 font-bold uppercase">
                            AI Analyze
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-[10px] font-bold uppercase text-on-secondary-container mb-1 ml-1">Peak Date</label>
                            <input type="date" id="peakFlavorDate" class="bg-surface/50 border-none font-bold text-on-surface">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold uppercase text-on-secondary-container mb-1 ml-1">Reasoning</label>
                            <textarea id="peakFlavorReason" rows="1" class="bg-surface/50 border-none text-xs" placeholder="..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Date</label>
                        <input type="date" id="bottlingDate" required>
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Closure</label>
                        <select id="closureTypeSelect">
                            <option value="auto">Automatic</option>
                            <option value="cork">Cork</option>
                            <option value="crown_cap_26">Crown Cap 26mm</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold uppercase text-on-surface-variant mb-2 ml-1">Bottle Count</label>
                    <div class="grid grid-cols-4 gap-2">
                        <div><label class="block text-[10px] text-center mb-1">750ml</label><input type="number" id="qty750" placeholder="0" class="text-center"></div>
                        <div><label class="block text-[10px] text-center mb-1">500ml</label><input type="number" id="qty500" placeholder="0" class="text-center"></div>
                        <div><label class="block text-[10px] text-center mb-1">330ml</label><input type="number" id="qty330" placeholder="0" class="text-center"></div>
                        <div><label class="block text-[10px] text-center mb-1">250ml</label><input type="number" id="qty250" placeholder="0" class="text-center"></div>
                    </div>
                </div>

                <div class="border-t border-outline-variant pt-4">
                    <label class="block text-xs font-bold uppercase text-on-surface-variant mb-2 ml-1">Custom Sizes</label>
                    <div class="grid grid-cols-3 gap-2">
                        <input type="number" id="customSize" placeholder="ml">
                        <input type="number" id="customQty" placeholder="Qty">
                        <input type="number" id="customPrice" placeholder="â‚¬">
                    </div>
                    <button type="button" onclick="window.addCustomBottleToList()" class="w-full mt-2 bg-surface-variant text-on-surface-variant font-bold py-2 px-3 rounded-full hover:bg-surface-variant/80 text-xs uppercase">
                        + Add Custom
                    </button>
                    <div id="custom-bottles-list" class="mt-2 space-y-1"></div>
                </div>
            </div>

            <div class="flex justify-end gap-3 mt-8 pt-4 border-t border-outline-variant">
                <button type="button" onclick="window.hideBottlingModal()" class="px-6 py-2 rounded-full text-primary font-bold hover:bg-surface-variant/10">Cancel</button>
                <button type="submit" class="px-6 py-2 rounded-full bg-primary text-on-primary font-bold shadow-elevation-1 hover:brightness-110">Confirm</button>
            </div>
        </form>
    </div>
</div>

<div id="gallery-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-[60] backdrop-blur-md p-4 animate-fade-in">
    <div class="bg-surface-container w-full max-w-3xl h-[85vh] flex flex-col rounded-[28px] shadow-2xl border border-outline-variant/30 overflow-hidden">
        <div class="p-4 border-b border-outline-variant flex justify-between items-center bg-surface">
            <h3 class="text-xl font-header font-normal text-primary flex items-center gap-2">
                ðŸ–¼ï¸ Cloud Gallery
            </h3>
            <button onclick="document.getElementById('gallery-modal').classList.add('hidden')" class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-surface-variant/20 text-on-surface text-xl">&times;</button>
        </div>
        
        <div id="gallery-grid" class="flex-grow overflow-y-auto p-6 grid grid-cols-2 md:grid-cols-3 gap-4 custom-scrollbar bg-surface-container-low">
            <div class="col-span-full text-center py-20 text-on-surface-variant opacity-50">Loading collection...</div>
        </div>
        
        <div class="p-4 border-t border-outline-variant bg-surface text-center">
            <p class="text-xs text-on-surface-variant">Images are securely stored in your private cloud.</p>
        </div>
    </div>
</div>

<div id="danger-modal" class="hidden fixed inset-0 bg-error-container/20 backdrop-blur-sm flex items-center justify-center z-[100]">
    <div class="bg-surface-container p-6 md:p-8 rounded-[28px] shadow-2xl border-2 border-error w-full max-w-md animate-bounce-in">
        <div class="flex flex-col items-center text-center mb-6">
            <div class="w-12 h-12 rounded-full bg-error/10 text-error flex items-center justify-center mb-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
            </div>
            <h3 class="text-xl font-bold text-on-surface">Irreversible Action</h3>
            <p class="text-sm text-on-surface-variant mt-2">
                This will permanently delete data. To confirm, type <span id="danger-confirm-text" class="font-bold font-mono text-error">DELETE</span> below.
            </p>
        </div>
        
        <input type="text" id="danger-confirm-input" 
               class="w-full p-4 border-2 border-outline-variant rounded-xl mb-6 text-center font-bold tracking-[0.2em] uppercase focus:border-error focus:ring-0 text-error placeholder-error/30"
               placeholder="TYPE HERE" oninput="window.checkDangerConfirmation()">
        
        <div class="flex gap-3">
            <button class="flex-1 py-3 rounded-full font-bold text-primary hover:bg-surface-variant/10 transition-colors" onclick="window.hideDangerModal()">
                Cancel
            </button>
            <button id="danger-confirm-btn" class="flex-1 py-3 rounded-full bg-error text-white font-bold opacity-50 cursor-not-allowed transition-all shadow-elevation-1" onclick="window.executeDangerAction()" disabled>
                DELETE
            </button>
        </div>
    </div>
</div>

<script type="module" src="app.js"></script>

<script>
    // RANDOM LOGIN MESSAGES
    document.addEventListener('DOMContentLoaded', () => {
        const subtitleEl = document.getElementById('login-subtitle');
        if(subtitleEl) {
            const messages = [
                "Did you sanitize everything? Be honest.",
                "Time to make bubbles.",
                "Resistance is futile. You will be fermented.",
                "In yeast we trust.",
                "Don't worry, have a homebrew.",
                "Checking fermentation status...",
                "Ready to disturb the yeast?",
                "Science! (But with alcohol)",
                "Is it Mead o'clock yet?",
                "Your microbes miss you."
            ];
            
            // Kies een willekeurige tekst
            const randomMsg = messages[Math.floor(Math.random() * messages.length)];
            subtitleEl.innerText = randomMsg;
        }
    });
</script>

<div id="label-format-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[70] transition-opacity p-4">
    <div class="bg-surface-container p-6 md:p-8 rounded-[28px] shadow-2xl w-full max-w-lg border border-outline-variant/50 animate-bounce-in max-h-[90vh] overflow-y-auto no-scrollbar">
        
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-header font-normal text-primary">Label Format Designer</h3>
            <button onclick="document.getElementById('label-format-modal').classList.add('hidden')" class="text-on-surface-variant hover:text-primary text-2xl">&times;</button>
        </div>

        <div class="mb-6 p-4 bg-purple-600/10 border border-purple-600/20 rounded-2xl">
            <label class="block text-[10px] font-bold uppercase text-purple-700 mb-2 tracking-widest">AI Specification Lookup</label>
            <div class="flex gap-2">
                <input type="text" id="lf-lookup-code" placeholder="e.g. Avery L7165 or Herma 4453" class="flex-grow text-xs bg-surface border-outline-variant rounded-xl p-3">
                <button id="lf-lookup-btn" onclick="window.autoDetectLabelFormat()" class="bg-purple-600 text-white px-4 py-2 rounded-xl text-xs font-bold hover:brightness-110 transition-all shadow-sm">
                    ðŸ” Find
                </button>
            </div>
            <p class="text-[9px] text-purple-600/70 mt-2 px-1">AI searches for technical specs (mm, rows, gaps) based on the brand/code.</p>
        </div>

        <form id="label-format-form" class="space-y-4">
            <div>
                <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Format Name</label>
                <input type="text" id="lf-name" placeholder="My Custom Label Sheet" required class="w-full bg-surface border-outline-variant rounded-xl p-3">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Label Width (mm)</label>
                    <input type="number" id="lf-width" step="0.1" placeholder="99.1" required class="w-full bg-surface border-outline-variant rounded-xl p-3">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Label Height (mm)</label>
                    <input type="number" id="lf-height" step="0.1" placeholder="67.7" required class="w-full bg-surface border-outline-variant rounded-xl p-3">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Columns</label>
                    <input type="number" id="lf-cols" placeholder="2" required class="w-full bg-surface border-outline-variant rounded-xl p-3">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase text-on-surface-variant mb-1 ml-1">Rows</label>
                    <input type="number" id="lf-rows" placeholder="4" required class="w-full bg-surface border-outline-variant rounded-xl p-3">
                </div>
            </div>

            <details class="group">
                <summary class="text-[10px] font-bold uppercase text-primary cursor-pointer list-none py-2 flex items-center gap-2">
                    <span class="transition-transform group-open:rotate-90">â–¶</span> Advanced Margins (mm)
                </summary>
                <div class="grid grid-cols-2 gap-4 pt-2">
                    <div>
                        <label class="block text-[10px] text-on-surface-variant mb-1 ml-1">Top Margin</label>
                        <input type="number" id="lf-marginTop" step="0.1" value="0" class="w-full bg-surface border-outline-variant rounded-xl p-2 text-xs">
                    </div>
                    <div>
                        <label class="block text-[10px] text-on-surface-variant mb-1 ml-1">Left Margin</label>
                        <input type="number" id="lf-marginLeft" step="0.1" value="0" class="w-full bg-surface border-outline-variant rounded-xl p-2 text-xs">
                    </div>
                    <div>
                        <label class="block text-[10px] text-on-surface-variant mb-1 ml-1">Gap X (Horizontal)</label>
                        <input type="number" id="lf-gapX" step="0.1" value="0" class="w-full bg-surface border-outline-variant rounded-xl p-2 text-xs">
                    </div>
                    <div>
                        <label class="block text-[10px] text-on-surface-variant mb-1 ml-1">Gap Y (Vertical)</label>
                        <input type="number" id="lf-gapY" step="0.1" value="0" class="w-full bg-surface border-outline-variant rounded-xl p-2 text-xs">
                    </div>
                </div>
            </details>

            <div class="flex gap-3 mt-8 pt-4 border-t border-outline-variant">
                <button type="button" id="deleteLabelFormatBtn" onclick="window.deleteCustomLabelFormat()" class="hidden px-4 py-2 rounded-full text-error font-bold hover:bg-error/10 transition-colors">
                    Delete
                </button>
                <div class="flex-grow"></div>
                <button type="button" onclick="document.getElementById('label-format-modal').classList.add('hidden')" class="px-6 py-2 rounded-full text-primary font-bold hover:bg-surface-variant/10 transition-colors">
                    Cancel
                </button>
                <button type="submit" class="px-8 py-2 rounded-full bg-primary text-on-primary font-bold shadow-elevation-1 hover:brightness-110 active:scale-95 transition-all">
                    Save Format
                </button>
            </div>
        </form>
    </div>
</div>

</body>
</html>