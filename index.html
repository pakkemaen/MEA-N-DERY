<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEA(N)DERY - AI Mead Recipe Creator</title>
    
    <meta name="theme-color" content="#a89a87"/>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192x192.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Semi+Condensed:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-app-primary text-app-primary">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        
        <header class="text-center mb-4 no-print">
            <h1 class="text-5xl font-header text-app-header">MEA<span class="text-app-brand">(N)</span>DERY</h1>
            <p class="text-app-secondary mt-2">AI Brewbuddy</p>
        </header>

        <!-- Main Content Area -->
        <div id="dashboard-main-view">
            <div class="bg-app-secondary p-6 md:p-8 rounded-lg shadow-lg overflow-y-auto" style="max-height: 80vh;">
                <h2 id="dashboard-greeting" class="text-3xl font-header font-bold mb-6 text-center">Good Morning!</h2>
                
                <div id="current-brew-card" class="card p-6 rounded-lg mb-6 hidden">
                    <!-- Content injected by JS -->
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <button data-view="brewing" class="main-nav-btn card p-6 rounded-lg text-center hover:shadow-lg transition-shadow btn">
                        <h3 class="text-xl font-header font-bold">Brewing</h3>
                        <p class="text-app-secondary/80 text-sm">Creator, Brew Day, History</p>
                    </button>
                    <button data-view="management" class="main-nav-btn card p-6 rounded-lg text-center hover:shadow-lg transition-shadow btn">
                        <h3 class="text-xl font-header font-bold">Management</h3>
                        <p class="text-app-secondary/80 text-sm">Inventory, Equipment, Planning</p>
                    </button>
                    <button data-view="tools" class="main-nav-btn card p-6 rounded-lg text-center hover:shadow-lg transition-shadow btn">
                        <h3 class="text-xl font-header font-bold">Tools</h3>
                        <p class="text-app-secondary/80 text-sm">Calculators, Water, Social</p>
                    </button>
                    <button data-view="settings" class="main-nav-btn card p-6 rounded-lg text-center hover:shadow-lg transition-shadow btn">
                        <h3 class="text-xl font-header font-bold">Settings</h3>
                        <p class="text-app-secondary/80 text-sm">Configure your app</p>
                    </button>
                </div>

                <div id="low-stock-card" class="card p-6 rounded-lg mb-6 hidden">
                     <h3 class="text-xl font-header font-bold mb-2 text-red-500">Low Stock Alerts</h3>
                     <ul id="low-stock-list" class="list-disc pl-5 text-app-secondary">
                        <!-- Content injected by JS -->
                     </ul>
                </div>

                <div class="card p-6 rounded-lg">
                    <h3 class="text-xl font-header font-bold mb-2">Alchemist's Tip of the Day</h3>
                    <p id="alchemist-tip" class="text-app-secondary/80 italic">Loading tip...</p>
                </div>
            </div>
        </div>

        <div id="brewing-main-view" class="hidden">
            <button class="back-to-dashboard-btn mb-4 text-app-brand hover:underline no-print">&larr; Back to Dashboard</button>
            <div class="bg-app-secondary p-4 rounded-b-lg shadow-inner">
                <nav class="flex space-x-2">
                    <button id="creator-sub-tab" class="sub-tab active px-4 py-2 rounded-md text-sm font-semibold">Creator</button>
                    <button id="brewing-sub-tab" class="sub-tab px-4 py-2 rounded-md text-sm font-semibold">Brew Day</button>
                    <button id="history-sub-tab" class="sub-tab px-4 py-2 rounded-md text-sm font-semibold">History</button>
                </nav>
            </div>
            <div id="creator-view">
                <div class="flex flex-col lg:flex-row gap-8 mt-4">
                    <aside class="lg:w-1/3 bg-app-secondary p-6 rounded-lg shadow-lg control-panel overflow-y-auto" style="max-height: 70vh;">
                        <h2 class="text-2xl font-header font-bold mb-6 border-b pb-4 border-app">Craft Your Mead</h2>
                        
                        <div class="mb-6">
                            <label for="customDescription" class="block text-sm font-bold mb-2">Describe Your Dream Mead</label>
                            <textarea id="customDescription" rows="4" placeholder="Be descriptive! e.g., 'A dry, sparkling mead with lavender and lemon, around 8% ABV, perfect for summer.'" class="w-full p-2 border rounded-md bg-app-tertiary border-app focus:ring-2 focus:ring-app-brand focus:border-app-brand text-app-primary"></textarea>
                            <p class="text-xs text-center text-app-secondary/80 mt-2">Or, use the options below for a more structured recipe.</p>
                        </div>

                        <div class="space-y-6 pt-6 border-t border-app">
                            <div>
                                <label for="batchSize" class="block text-sm font-bold mb-2">Batch Size (Liters)</label>
                                <input type="number" id="batchSize" value="5" class="w-full p-2 border rounded-md bg-app-tertiary border-app focus:ring-2 focus:ring-app-brand focus:border-app-brand text-app-primary">
                            </div>
                            <div>
                                <label for="abv" class="block text-sm font-bold mb-2">Target ABV (%)</label>
                                <input type="number" id="abv" value="12" min="5" max="18" class="w-full p-2 border rounded-md bg-app-tertiary border-app focus:ring-2 focus:ring-app-brand focus:border-app-brand text-app-primary">
                            </div>
                            <div>
                                <label for="sweetness" class="block text-sm font-bold mb-2">Final Sweetness</label>
                                <select id="sweetness" class="w-full p-2 border rounded-md bg-app-tertiary border-app focus:ring-2 focus:ring-app-brand focus:border-app-brand text-app-primary">
                                    <option value="dry">Dry (FG ~1.000)</option>
                                    <option value="semi-sweet" selected>Semi-Sweet (FG ~1.015)</option>
                                    <option value="sweet">Sweet (FG ~1.030)</option>
                                </select>
                            </div>
                            <div>
                                <label for="style" class="block text-sm font-bold mb-2">Base Style</label>
                                <select id="style" class="w-full p-2 border rounded-md bg-app-tertiary border-app focus:ring-2 focus:ring-app-brand focus:border-app-brand text-app-primary">
                                    <optgroup label="Standard Styles">
                                        <option value="bochet">Bochet (Caramelized Honey)</option>
                                        <option value="braggot">Braggot (Beer/Mead Hybrid)</option>
                                        <option value="capsicumel">Capsicumel (Chili Mead)</option>
                                        <option value="cyser">Cyser (Apple Mead)</option>
                                        <option value="melomel">Melomel (Fruit Mead)</option>
                                        <option value="metheglin">Metheglin (Spiced Mead)</option>
                                        <option value="pyment">Pyment (Grape Mead)</option>
                                        <option value="rhodomel">Rhodomel (Rose Mead)</option>
                                        <option value="traditional">Traditional</option>
                                    </optgroup>
                                    <optgroup label="Belgian Specials">
                                        <option value="belgian_dubbel">Dubbel Style</option>
                                        <option value="belgian_gruit">Gruit (Hopless Herb Mead)</option>
                                        <option value="belgian_kriek">Kriek Style</option>
                                        <option value="lambic">Lambic Style</option>
                                        <option value="oud_bruin">Oud Bruin Style</option>
                                        <option value="belgian_quad">Quadrupel (Westvleteren 12 Inspired)</option>
                                        <option value="belgian_saison">Saison de Pipaix Style</option>
                                        <option value="belgian_tripel">Tripel Style</option>
                                        <option value="belgian_wit">Wit Style</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div>
                                <label for="honeyVariety" class="block text-sm font-bold mb-2">Honey Variety</label>
                                <select id="honeyVariety" class="w-full p-2 border rounded-md bg-app-tertiary border-app focus:ring-2 focus:ring-app-brand focus:border-app-brand text-app-primary">
                                    <option value="Acacia">Acacia</option>
                                    <option value="Buckwheat">Buckwheat</option>
                                    <option value="Clover">Clover</option>
                                    <option value="Forest/Boshoning">Forest Honey (Boshoning)</option>
                                    <option value="Linden/Linde">Linden Honey (Lindehoning)</option>
                                    <option value="Orange Blossom">Orange Blossom</option>
                                    <option value="Wildflower" selected>Wildflower (Default)</option>
                                </select>
                            </div>
                            <div>
                                <label for="nutrientProtocol" class="block text-sm font-bold mb-2">Nutrient Protocol</label>
                                <select id="nutrientProtocol" class="w-full p-2 border rounded-md bg-app-tertiary border-app focus:ring-2 focus:ring-app-brand focus:border-app-brand text-app-primary">
                                    <option value="staggered" selected>Standard Staggered (24/48/72h)</option>
                                    <option value="tosna">TOSNA 2.0 (Organic)</option>
                                    <option value="simple">Simple (All at Pitch)</option>
                                </select>
                            </div>
                            <div id="fruit-section" class="hidden space-y-2">
                                <label class="block text-sm font-bold">Choose Fruits (for Melomel)</label>
                                <div class="grid grid-cols-2 gap-2 text-sm">
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="fruit_apples" class="mr-2"><label for="fruit_apples">Apples</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="fruit_apricots" class="mr-2"><label for="fruit_apricots">Apricots</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="fruit_blackberries" class="mr-2"><label for="fruit_blackberries">Blackberries</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="fruit_blackcurrants" class="mr-2"><label for="fruit_blackcurrants">Blackcurrants</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="fruit_blueberries" class="mr-2"><label for="fruit_blueberries">Blueberries</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="fruit_cherries" class="mr-2"><label for="fruit_cherries">Cherries</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="fruit_gooseberries" class="mr-2"><label for="fruit_gooseberries">Gooseberries</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="fruit_peaches" class="mr-2"><label for="fruit_peaches">Peaches</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="fruit_pears" class="mr-2"><label for="fruit_pears">Pears</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="fruit_plums" class="mr-2"><label for="fruit_plums">Plums</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="fruit_raspberries" class="mr-2"><label for="fruit_raspberries">Raspberries</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="fruit_redcurrants" class="mr-2"><label for="fruit_redcurrants">Redcurrants</label></div>
                                </div>
                            </div>
                             <div id="spice-section" class="hidden space-y-2">
                                <label class="block text-sm font-bold">Choose Spices (for Metheglin)</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="spice_cinnamon" class="mr-2"><label for="spice_cinnamon">Cinnamon</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="spice_cloves" class="mr-2"><label for="spice_cloves">Cloves</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="spice_coriander" class="mr-2"><label for="spice_coriander">Coriander</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="spice_nutmeg" class="mr-2"><label for="spice_nutmeg">Nutmeg</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="spice_orange" class="mr-2"><label for="spice_orange">Orange Peel</label></div>
                                    <div class="p-2 rounded hover:bg-app-primary"><input type="checkbox" id="spice_vanilla" class="mr-2"><label for="spice_vanilla">Vanilla</label></div>
                                </div>
                            </div>
                            <div id="braggot-section" class="hidden">
                                <label for="braggotStyle" class="block text-sm font-bold mb-2">Braggot Base Style</label>
                                <select id="braggotStyle" class="w-full p-2 border rounded-md bg-app-tertiary border-app focus:ring-2 focus:ring-app-brand focus:border-app-brand text-app-primary">
                                    <option value="belgian_blond">Belgian Blond</option>
                                    <option value="dubbel">Belgian Dubbel</option>
                                    <option value="ipa">IPA</option>
                                    <option value="old_ale">Old Ale / Barleywine</option>
                                    <option value="saison">Saison</option>
                                    <option value="scotch_ale">Scotch Ale / Wee Heavy</option>
                                    <option value="stout">Stout</option>
                                </select>
                            </div>
                            <div class="space-y-4 pt-4 border-t border-app">
                                <div class="flex items-center">
                                    <input type="checkbox" id="addOak" class="h-4 w-4 rounded border-gray-300 text-app-brand focus:ring-app-brand">
                                    <label for="addOak" class="ml-3 block text-sm font-bold">Include Oak Aging?</label>
                                </div>
                                <div>
                                    <label for="specialIngredients" class="block text-sm font-bold mb-2">Special Ingredients (optional)</label>
                                    <input type="text" id="specialIngredients" placeholder="e.g., Rose petals, Lapsang tea..." class="w-full p-2 border rounded-md bg-app-tertiary border-app focus:ring-2 focus:ring-app-brand focus:border-app-brand text-app-primary">
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-4 pt-4 border-t-2 border-app-brand mt-6">
                             <div class="flex items-center">
                                <input type="checkbox" id="useInventory" class="h-4 w-4 rounded border-gray-300 text-app-brand focus:ring-app-brand">
                                <label for="useInventory" class="ml-3 block text-sm font-bold text-app-brand">Create recipe from my inventory</label>
                            </div>
                        </div>


                        <div class="mt-8">
                            <button id="generateBtn" class="w-full bg-app-action text-white font-bold py-3 px-4 rounded-lg hover:opacity-90 transition-all duration-300 shadow-md btn">
                                Generate Recipe
                            </button>
                        </div>
                    </aside>

                    <main class="lg:w-2/3 bg-app-secondary p-6 md:p-8 rounded-lg shadow-lg overflow-y-auto" style="max-height: 70vh;">
                        <div id="recipe-output" class="prose max-w-none text-app-primary">
                        </div>
                    </main>
                </div>
            </div>
            <div id="brewing-view" class="hidden mt-4">
                <div class="bg-app-secondary p-6 md:p-8 rounded-lg shadow-lg overflow-y-auto" style="max-height: 70vh;">
                    <div id="brew-day-content">
                        <h2 class="text-3xl font-header font-bold mb-4 text-center">Brew Day Assistant</h2>
                        <p class="text-center text-app-secondary/80">Generate a recipe or load one from history, then click "Start Brew Day" to begin.</p>
                    </div>
                </div>
            </div>
            <div id="history-view" class="hidden mt-4">
                 <div class="bg-app-secondary p-6 md:p-8 rounded-lg shadow-lg overflow-y-auto" style="max-height: 70vh;">
                    <div id="history-list-container">
                        <h2 class="text-3xl font-header font-bold mb-4 text-center">Brew History</h2>
                        <div id="history-list" class="space-y-4">
                            </div>
                    </div>
                    <div id="history-detail-container" class="hidden">
                        </div>
                 </div>
            </div>
        </div>

        <div id="management-main-view" class="hidden">
             <button class="back-to-dashboard-btn mb-4 text-app-brand hover:underline no-print">&larr; Back to Dashboard</button>
             <div class="bg-app-secondary p-4 rounded-b-lg shadow-inner">
                <nav class="flex space-x-2">
                    <button id="inventory-sub-tab" class="sub-tab active px-4 py-2 rounded-md text-sm font-semibold">Inventory</button>
                    <button id="planning-sub-tab" class="sub-tab px-4 py-2 rounded-md text-sm font-semibold">Planning</button>
                    <button id="financials-sub-tab" class="sub-tab px-4 py-2 rounded-md text-sm font-semibold">Financials</button>
                </nav>
            </div>
            <div id="inventory-view" class="mt-4">
                <div class="flex flex-col lg:flex-row gap-8">
                    <aside class="lg:w-1/3 bg-app-secondary p-6 rounded-lg shadow-lg">
                        <h2 class="text-2xl font-header font-bold mb-6 border-b pb-4 border-app">Add to Inventory</h2>
                        <form id="inventory-form" class="space-y-4">
                            <div>
                                <label for="itemName" class="block text-sm font-bold mb-2">Ingredient Name</label>
                                <input type="text" id="itemName" placeholder="e.g., Acacia Honey" required class="w-full p-2 border rounded-md bg-app-tertiary border-app focus:ring-2 focus:ring-app-brand focus:border-app-brand text-app-primary">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="itemQty" class="block text-sm font-bold mb-2">Quantity</label>
                                    <input type="number" id="itemQty" step="0.01" placeholder="e.g., 1.5" required class="w-full p-2 border rounded-md bg-app-tertiary border-app focus:ring-2 focus:ring-app-brand focus:border-app-brand text-app-primary">
                                </div>
                                <div>
                                    <label for="itemUnit" class="block text-sm font-bold mb-2">Unit</label>
                                    <select id="itemUnit" class="w-full p-2 border rounded-md bg-app-tertiary border-app focus:ring-2 focus:ring-app-brand focus:border-app-brand text-app-primary">
                                        <option>kg</option>
                                        <option>g</option>
                                        <option>L</option>
                                        <option>ml</option>
                                        <option>packets</option>
                                        <option>items</option>
                                    </select>
                                </div>
                            </div>
                             <div>
                                <label for="itemPrice" class="block text-sm font-bold mb-2">Price (€)</label>
                                <input type="number" id="itemPrice" step="0.01" placeholder="e.g., 12.50" required class="w-full p-2 border rounded-md bg-app-tertiary border-app focus:ring-2 focus:ring-app-brand focus:border-app-brand text-app-primary">
                            </div>
                            <div>
                                <label for="itemCategory" class="block text-sm font-bold mb-2">Category</label>
                                <select id="itemCategory" class="w-full p-2 border rounded-md bg-app-tertiary border-app focus:ring-2 focus:ring-app-brand focus:border-app-brand text-app-primary">
                                    <option>Honey</option>
                                    <option>Yeast</option>
                                    <option>Nutrient</option>
                                    <option>Malt Extract</option>
                                    <option>Fruit</option>
                                    <option>Spice</option>
                                    <option>Adjunct</option>
                                    <option>Chemical</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full bg-app-brand text-white font-bold py-3 px-4 rounded-lg hover:opacity-90 transition-all duration-300 shadow-md btn">Add Ingredient</button>
                        </form>
                    </aside>
                    <main class="lg:w-2/3 bg-app-secondary p-6 md:p-8 rounded-lg shadow-lg inventory-panel overflow-y-auto" style="max-height: 70vh;">
                        <h2 class="text-3xl font-header font-bold mb-4 text-center">Current Stock</h2>
                        <div id="inventory-list">
                            </div>
                    </main>
                </div>
            </div>
            <div id="planning-view" class="hidden mt-4">
                <div class="bg-app-secondary p-6 md:p-8 rounded-lg shadow-lg overflow-y-auto" style="max-height: 70vh;">
                     <h2 class="text-3xl font-header font-bold mb-6 text-center">Planning</h2>
                     <div id="shopping-list-container" class="mb-8">
                        <h3 class="text-2xl font-header mb-4">Shopping List</h3>
                        <div id="shopping-list-content" class="p-4 card rounded-lg">
                            <p class="text-app-secondary">Load a recipe from your history and click "Generate Shopping List" to see what you need.</p>
                        </div>
                     </div>
                </div>
            </div>
            <div id="financials-view" class="hidden mt-4">
                <div class="bg-app-secondary p-6 md:p-8 rounded-lg shadow-lg overflow-y-auto" style="max-height: 70vh;">
                     <h2 class="text-3xl font-header font-bold mb-6 text-center">Financials</h2>
                     <div id="cost-analysis-container">
                        <h3 class="text-2xl font-header mb-4">Cost Analysis</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="card p-4 rounded-lg text-center">
                                <h4 class="text-lg font-bold text-app-secondary">Total Inventory Value</h4>
                                <p id="total-spend" class="text-3xl font-bold text-app-brand">€0.00</p>
                            </div>
                            <div class="card p-4 rounded-lg text-center">
                                <h4 class="text-lg font-bold text-app-secondary">Average Cost Per Batch</h4>
                                <p id="avg-cost" class="text-3xl font-bold text-app-brand">€0.00</p>
                            </div>
                        </div>
                        <div class="card p-4 rounded-lg mt-6">
                            <h4 class="text-lg font-bold text-app-secondary text-center mb-4">Spend by Category</h4>
                            <canvas id="cost-chart"></canvas>
                        </div>
                     </div>
                     <div id="overhead-container" class="mt-8">
                        <h3 class="text-2xl font-header mb-4">Utilities & Overhead Cost Calculator</h3>
                        <div class="card p-6 rounded-lg space-y-4">
                            <div>
                                <label for="electricityCost" class="block font-bold mb-1">Electricity Cost (per kWh)</label>
                                <input type="number" id="electricityCost" placeholder="0.35" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                            </div>
                            <div>
                                <label for="waterCost" class="block font-bold mb-1">Water Cost (per m³)</label>
                                <input type="number" id="waterCost" placeholder="5.00" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                            </div>
                            <div>
                                <label for="sanitizerCost" class="block font-bold mb-1">Sanitizer Cost (per batch)</label>
                                <input type="number" id="sanitizerCost" placeholder="1.50" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                            </div>
                            <button id="calculateOverheadBtn" class="w-full bg-app-action text-white font-bold py-2 px-4 rounded-lg hover:opacity-90 btn">Calculate Overhead</button>
                            <div id="overheadResult" class="text-center font-bold text-lg mt-2 h-8"></div>
                        </div>
                     </div>
                </div>
            </div>
        </div>

        <div id="tools-main-view" class="hidden">
             <button class="back-to-dashboard-btn mb-4 text-app-brand hover:underline no-print">&larr; Back to Dashboard</button>
            <div class="bg-app-secondary p-4 rounded-b-lg shadow-inner">
                <nav class="flex space-x-2 overflow-x-auto">
                    <button id="calculators-sub-tab" class="sub-tab active px-4 py-2 rounded-md text-sm font-semibold">Calculators</button>
                    <button id="water-sub-tab" class="sub-tab px-4 py-2 rounded-md text-sm font-semibold">Water</button>
                    <button id="troubleshoot-sub-tab" class="sub-tab px-4 py-2 rounded-md text-sm font-semibold">Troubleshoot</button>
                    <button id="social-sub-tab" class="sub-tab px-4 py-2 rounded-md text-sm font-semibold">Social</button>
                </nav>
            </div>
            <div id="calculators-view" class="mt-4">
                <div class="bg-app-secondary p-6 md:p-8 rounded-lg shadow-lg calculator-panel overflow-y-auto" style="max-height: 70vh;">
                    <h2 class="text-3xl font-header font-bold mb-6 text-center">Brewing Calculators</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <div class="p-4 card rounded-lg">
                            <h3 class="text-xl font-header mb-4">ABV Calculator</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="og" class="block text-sm font-bold mb-1">Original Gravity (OG)</label>
                                    <input type="number" id="og" step="0.001" placeholder="e.g., 1.110" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                </div>
                                <div>
                                    <label for="fg" class="block text-sm font-bold mb-1">Final Gravity (FG)</label>
                                    <input type="number" id="fg" step="0.001" placeholder="e.g., 1.015" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                </div>
                                <button id="calcAbvBtn" class="w-full bg-app-action text-white font-bold py-2 px-4 rounded-lg hover:opacity-90 btn">Calculate ABV</button>
                                <div id="abvResult" class="text-center font-bold text-lg mt-2 h-8"></div>
                            </div>
                        </div>
                        <div class="p-4 card rounded-lg">
                            <h3 class="text-xl font-header mb-4">Hydrometer Correction</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="sgReading" class="block text-sm font-bold mb-1">Hydrometer Reading</label>
                                    <input type="number" id="sgReading" step="0.001" placeholder="e.g., 1.052" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                </div>
                                <div>
                                    <label for="tempReading" class="block text-sm font-bold mb-1">Liquid Temperature (°C)</label>
                                    <input type="number" id="tempReading" placeholder="e.g., 25" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                </div>
                                 <div>
                                    <label for="calTemp" class="block text-sm font-bold mb-1">Hydrometer Calibration Temp (°C)</label>
                                    <input type="number" id="calTemp" value="20" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                </div>
                                <button id="correctSgBtn" class="w-full bg-app-action text-white font-bold py-2 px-4 rounded-lg hover:opacity-90 btn">Correct Gravity</button>
                                <div id="sgResult" class="text-center font-bold text-lg mt-2 h-8"></div>
                            </div>
                        </div>
                        <div class="p-4 card rounded-lg">
                            <h3 class="text-xl font-header mb-4">Priming Sugar Calculator</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="carbVol" class="block text-sm font-bold mb-1">Desired CO2 Volumes</label>
                                    <input type="number" id="carbVol" step="0.1" placeholder="e.g., 2.5" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                </div>
                                <div>
                                    <label for="carbTemp" class="block text-sm font-bold mb-1">Mead Temperature (°C)</label>
                                    <input type="number" id="carbTemp" placeholder="e.g., 20" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                </div>
                                 <div>
                                    <label for="carbBatchSize" class="block text-sm font-bold mb-1">Batch Size (Liters)</label>
                                    <input type="number" id="carbBatchSize" step="0.1" placeholder="e.g., 5" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                </div>
                                <button id="calcSugarBtn" class="w-full bg-app-action text-white font-bold py-2 px-4 rounded-lg hover:opacity-90 btn">Calculate Sugar</button>
                                <div id="sugarResult" class="text-center font-bold text-lg mt-2 h-8"></div>
                            </div>
                        </div>
                        <div class="p-4 card rounded-lg">
                            <h3 class="text-xl font-header mb-4">Blending Calculator</h3>
                            <div class="space-y-4">
                                 <div>
                                    <label class="block text-sm font-bold mb-1">Liquid 1</label>
                                    <div class="flex gap-2">
                                        <input type="number" id="vol1" placeholder="Volume (L)" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                        <input type="number" id="sg1" step="0.001" placeholder="SG (e.g. 1.050)" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold mb-1">Liquid 2</label>
                                    <div class="flex gap-2">
                                        <input type="number" id="vol2" placeholder="Volume (L)" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                        <input type="number" id="sg2" step="0.001" placeholder="SG (e.g. 1.000)" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                    </div>
                                </div>
                                <button id="calcBlendBtn" class="w-full bg-app-action text-white font-bold py-2 px-4 rounded-lg hover:opacity-90 btn">Calculate Blend</button>
                                <div id="blendResult" class="text-center font-bold text-lg mt-2 h-8"></div>
                            </div>
                        </div>
                        <div class="p-4 card rounded-lg md:col-span-2 lg:col-span-3">
                            <h3 class="text-xl font-header mb-4">AI Yeast Starter Calculator</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label for="starterOG" class="block text-sm font-bold mb-1">Starting Gravity (OG)</label>
                                    <input type="number" id="starterOG" step="0.001" placeholder="e.g., 1.120" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                </div>
                                <div>
                                    <label for="yeastDate" class="block text-sm font-bold mb-1">Yeast Production Date</label>
                                    <input type="date" id="yeastDate" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                </div>
                                <div>
                                    <label for="yeastType" class="block text-sm font-bold mb-1">Yeast Type</label>
                                    <select id="yeastType" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                        <option value="liquid">Liquid Yeast</option>
                                        <option value="dry">Dry Yeast</option>
                                    </select>
                                </div>
                            </div>
                            <button id="getYeastAdviceBtn" class="w-full mt-4 bg-purple-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-800 btn">Get Yeast Advice</button>
                            <div id="yeast-advice-output" class="prose max-w-none text-app-primary mt-4"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="water-view" class="hidden mt-4">
                <div class="flex flex-col lg:flex-row gap-8">
                    <aside class="lg:w-1/3 bg-app-secondary p-6 rounded-lg shadow-lg">
                        <h2 class="text-2xl font-header font-bold mb-6 border-b pb-4 border-app">Water Profile</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="waterSource" class="block text-sm font-bold mb-2">Select Water Profile</label>
                                <select id="waterSource" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                    <option value="spa">Spa Reine</option>
                                    <option value="chaudfontaine">Chaudfontaine</option>
                                    <option value="valvert">Valvert</option>
                                    <option value="bru">Bru</option>
                                    <option value="villers">Villers</option>
                                    <option value="manual">Manual Entry</option>
                                </select>
                            </div>
                            <div id="manualWaterProfile" class="hidden space-y-2 pt-4 border-t border-app">
                                 <h4 class="font-bold text-center">Enter Manual Profile (mg/L)</h4>
                                 <div class="grid grid-cols-2 gap-2">
                                    <div><label for="manual_ca">Ca</label><input type="number" id="manual_ca" class="w-full p-1 border rounded-md bg-app-tertiary border-app text-app-primary"></div>
                                    <div><label for="manual_mg">Mg</label><input type="number" id="manual_mg" class="w-full p-1 border rounded-md bg-app-tertiary border-app text-app-primary"></div>
                                    <div><label for="manual_na">Na</label><input type="number" id="manual_na" class="w-full p-1 border rounded-md bg-app-tertiary border-app text-app-primary"></div>
                                    <div><label for="manual_so4">SO4</label><input type="number" id="manual_so4" class="w-full p-1 border rounded-md bg-app-tertiary border-app text-app-primary"></div>
                                    <div><label for="manual_cl">Cl</label><input type="number" id="manual_cl" class="w-full p-1 border rounded-md bg-app-tertiary border-app text-app-primary"></div>
                                    <div><label for="manual_hco3">HCO3</label><input type="number" id="manual_hco3" class="w-full p-1 border rounded-md bg-app-tertiary border-app text-app-primary"></div>
                                 </div>
                            </div>
                            <button id="fetchWaterProfileBtn" class="w-full bg-app-action text-white font-bold py-2 px-4 rounded-lg hover:opacity-90 btn">Fetch Profile</button>
                            <div id="waterProfileDisplay" class="mt-4 p-4 card rounded-lg">
                                <h4 class="font-bold font-header text-lg mb-2">Active Mineral Profile (mg/L)</h4>
                                <ul class="space-y-1 text-sm text-app-primary">
                                    <li><strong>Calcium (Ca):</strong> <span id="val-ca">--</span></li>
                                    <li><strong>Magnesium (Mg):</strong> <span id="val-mg">--</span></li>
                                    <li><strong>Sodium (Na):</strong> <span id="val-na">--</span></li>
                                    <li><strong>Sulfate (SO4):</strong> <span id="val-so4">--</span></li>
                                    <li><strong>Chloride (Cl):</strong> <span id="val-cl">--</span></li>
                                    <li><strong>Bicarbonate (HCO3):</strong> <span id="val-hco3">--</span></li>
                                </ul>
                            </div>
                        </div>
                    </aside>
                    <main class="lg:w-2/3 bg-app-secondary p-6 md:p-8 rounded-lg shadow-lg overflow-y-auto" style="max-height: 70vh;">
                        <h2 class="text-3xl font-header font-bold mb-4 text-center">AI Adjustment Recommendations</h2>
                        <div class="space-y-4 mb-6">
                            <div>
                                <label for="meadTargetProfile" class="block text-sm font-bold mb-2">Desired Mead Character</label>
                                <select id="meadTargetProfile" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                    <option value="balanced">Balanced / All-Purpose</option>
                                    <option value="dry_crisp">Dry & Crisp (e.g., Traditional, Saison)</option>
                                    <option value="rich_full">Rich & Full-bodied (e.g., Sweet Melomel, Quad)</option>
                                    <option value="hoppy_braggot">Hoppy Braggot (IPA style)</option>
                                </select>
                            </div>
                            <button id="getWaterAdviceBtn" class="w-full bg-purple-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-800 btn">Get Brewing Advice</button>
                        </div>
                        <div id="water-advice-output" class="prose max-w-none text-app-primary">
                            <p class="text-center text-app-secondary/80">Select a water source and a desired mead character, then ask the Alchemist for advice.</p>
                        </div>
                    </main>
                </div>
            </div>
            <div id="troubleshoot-view" class="hidden mt-4">
                 <div class="bg-app-secondary p-6 md:p-8 rounded-lg shadow-lg overflow-y-auto" style="max-height: 70vh;">
                    <h2 class="text-3xl font-header font-bold mb-6 text-center">AI Troubleshooter</h2>
                    <div class="max-w-xl mx-auto">
                        <div class="card p-6 rounded-lg">
                            <label for="troubleshoot-description" class="block text-lg font-bold mb-2">Describe your brewing problem:</label>
                            <textarea id="troubleshoot-description" rows="5" placeholder="e.g., My fermentation seems to have stopped after only 3 days. The airlock isn't bubbling anymore." class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary"></textarea>
                            <button id="troubleshoot-btn" class="w-full mt-4 bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 btn">Get Advice</button>
                        </div>
                        <div id="troubleshoot-output" class="mt-6 prose max-w-none text-app-primary"></div>
                    </div>
                 </div>
            </div>
            <div id="social-view" class="hidden mt-4">
                <div class="bg-app-secondary p-6 md:p-8 rounded-lg shadow-lg overflow-y-auto" style="max-height: 70vh;">
                    <h2 class="text-3xl font-header font-bold mb-6 text-center">Social Media Assistant</h2>
                    <div id="social-content-container">
                        <p class="text-center text-app-secondary/80">Load a recipe from your history and click "Generate Social Post" to get started.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="settings-view" class="hidden">
            <button class="back-to-dashboard-btn mb-4 text-app-brand hover:underline no-print">&larr; Back to Dashboard</button>
            <div class="bg-app-secondary p-6 md:p-8 rounded-lg shadow-lg settings-panel overflow-y-auto" style="max-height: 80vh;">
                <h2 class="text-3xl font-header font-bold mb-6 text-center">Settings</h2>
                <div class="max-w-xl mx-auto">
                    <div class="mb-6 card p-6 rounded-lg">
                        <h3 class="text-xl font-header font-bold mb-4">API Key</h3>
                        <label for="apiKeyInput" class="block text-lg font-bold mb-2">Google AI API Key</label>
                        <input type="password" id="apiKeyInput" placeholder="Enter your Google AI API key" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                        <p class="text-sm text-app-secondary mt-3">
                            The AI features of this app require a Google AI API key to function. Your key is saved securely to your user account and is never shared with anyone.
                        </p>
                        <p class="text-sm text-app-secondary mt-2">
                            You can get a free key from <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" class="text-app-brand hover:underline font-semibold">Google AI Studio</a>.
                        </p>
                    </div>

                    <div class="mb-6 card p-6 rounded-lg">
                        <h3 class="text-xl font-header font-bold mb-4">Personalization & Defaults</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="defaultBatchSizeInput" class="block text-lg font-bold mb-2">Default Batch Size (Liters)</label>
                                <input type="number" id="defaultBatchSizeInput" placeholder="e.g., 20" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                <p class="text-sm text-app-secondary mt-2">Set the default batch size that appears on the Creator tab.</p>
                            </div>
                            <div>
                                <label for="defaultCurrencyInput" class="block text-lg font-bold mb-2">Currency Symbol</label>
                                <input type="text" id="defaultCurrencyInput" placeholder="e.g., $" class="w-full p-2 border rounded-md bg-app-tertiary border-app text-app-primary">
                                 <p class="text-sm text-app-secondary mt-2">Set the currency symbol used for cost calculations.</p>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6 card p-6 rounded-lg">
                        <h3 class="text-xl font-header font-bold mb-4">User Interface</h3>
                        <div class="flex items-center justify-between">
                            <label class="text-lg font-bold">Theme</label>
                            <div class="theme-switch-wrapper">
                                <label class="theme-switch" for="theme-toggle-checkbox">
                                    <input type="checkbox" id="theme-toggle-checkbox" />
                                    <div class="slider round"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <button id="saveSettingsBtn" class="w-full mt-4 bg-blue-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-800 btn">Save Settings</button>
                    <div id="settingsMessage" class="text-center font-semibold mt-4 h-6"></div>

                    <div class="mt-10 p-6 rounded-lg border-2 border-red-400">
                        <h3 class="text-xl font-header font-bold mb-4 text-red-600">Data Management</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <button id="exportHistoryBtn" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 btn">Export Brew History</button>
                            <button id="exportInventoryBtn" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 btn">Export Inventory</button>
                            <div>
                                <label for="importHistoryFile" class="w-full text-center block bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 cursor-pointer btn">Import Brew History</label>
                                <input type="file" id="importHistoryFile" class="hidden" accept=".json">
                            </div>
                             <div>
                                <label for="importInventoryFile" class="w-full text-center block bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 cursor-pointer btn">Import Inventory</label>
                                <input type="file" id="importInventoryFile" class="hidden" accept=".json">
                            </div>
                        </div>
                        <div class="space-y-4 mt-8 border-t-2 border-red-400 pt-4">
                            <p class="text-sm text-red-500 text-center">Warning: The following actions cannot be undone.</p>
                            <button id="clearHistoryBtn" class="w-full bg-red-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-800 btn">Delete All Brew History</button>
                            <button id="clearInventoryBtn" class="w-full bg-red-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-800 btn">Delete All Inventory</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script type="module" src="script.js"></script>
</body>
</html>
